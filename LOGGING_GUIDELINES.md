# Руководство по безопасному логированию

## Проблема

При логировании объектов, содержащих изображения (Buffer), в логах появляются длинные последовательности чисел, что делает логи нечитаемыми и увеличивает их размер.

## Решение

Создана система безопасного логирования, которая автоматически заменяет Buffer данные на краткие описания.

## Использование

### 1. Логирование session объектов

Вместо:
```typescript
console.log(ctx.session, 'ctx.session')
```

Используйте:
```typescript
import { logSessionSafely } from '@/utils/logger'
logSessionSafely(ctx.session, 'ctx.session')
```

### 2. Безопасный console.log

Вместо:
```typescript
console.log(largeObject)
```

Используйте:
```typescript
import { safeConsoleLog } from '@/utils/logger'
safeConsoleLog(largeObject)
```

### 3. Автоматическая защита (уже активирована)

Система автоматически перехватывает все `console.log` и очищает их от Buffer данных.

## Что заменяется

- `Buffer` → `<Buffer X bytes>`
- `Uint8Array` → `<Uint8Array X bytes>`
- Массивы изображений → `{ filename, bufferSize, hasBuffer }`
- Большие массивы (>100 элементов) → `<Array X items (truncated for logging)>`

## Пример вывода

Было:
```
2025-04-13 02:50:31 [INFO]: ctx.session {
  "images": [
    {
      "buffer": [192,195,142,207,18,195,214,98,209,214,52,7,4,101,137,198,226,229,146,251,193,1,86,60,11,12,12,54,81,129,184,23,13,129,6,193,29,141,4,210,93,121,66,6,27,156,91,182,40,218,241,204,35,6,24,90,191,104,113,130,29,56,151,121,93,120,122,68,5,175,23,22,184,194,89,215,250,254,99,255,0,2,225,252,99,66,97,133,251,62,255,0,120,204,75,13,36,14,88,229,120,149,186,199,46,215,115,40,12,150,204,151,116,226,108,85,117,151,167,198,160,12,32,239,136,35,32,28,117,169,126,22,158,208,13,181,134,150,226,53,233,204,198,114,154,123,69,157,78,90,150,57,53,156,186,137,66,182,231,136,24,179,124,140,106,167,204,50,196,112,163,223,49,80,47,203,112,176,33,232,146,148,26,255,0,55,233,40,2,204,227,183,167,51,66,227,222,115,47,254,161,252,209,23,97,73,26,130,197,203,249,245,129,239,138,224,140,32,112,39,23,138,51,42,167,51,39,70,116,66,107,7,85,90,205,169,174,94,178,252,20,28,36,218,23,27,162,47,108,17,154,202,181,125,35,101,162,186,76,5,14,203,47,5,22,58,35,186,167,251,138,139,182,211,22,203,54,72,119,37,43,135,88,186,17,237,189,51,6,176,233,117,30,151,178,205,207,167,88,219,2,163,56,193,188,117,215,131,15,133,199,207,124,111,248,207,194,124,202,254,38,2,85,213,215,80,252,194,11,130,189,35,186,100,193,91,136,253,49,185,134,172,101,5,62,241,73,69,157,88,73,77,177,40,17,70,123,197,149,169,210,81,40,203,6,159,168,19,55,87,186,130,160,52,112,92,4,202,13,116,143,1,231,152,216,83,142,106,88,56,168,139,135,112,85,154,173,89,16,34,103,155,46,163,178,101,197,64,203,129,164,109,53,9,32,172,78,126,3,197,96,255,0,29,254,3,255,0,21,143,178,61,240,164,27,187,122,18,169,183,171,3,125,176,68,50,133,240,193,9,83,187,13,91,111,202,11,155,79,94,98,68,58,171,204,71,55,87,146,224,111,110,113,12,233,184,5,70,194,30,236,190,247,136,53,118,53,196,91,104,191,121,114,54,9,200,81,50,26,239,196,55,22,110,61,53,231,218,29,57,176,239,5,71,79,102,48,91,76,248,31,128,240,101,74,249,28,76,252,183,249,231,242,89,221,4,244,63,184,51,131,150,24,109,155,150,91,230,37,164,86,116,49,124,203,172,117,222,97,194,163,229,17,201,93,46,94,206,189,127,104,2,170,212,180,17,166,173,255,0,143,40,164,23,209,184,182,135,52,132,92,251,5,101,13,43,105,15,73,126,189,231,57,236,204,98,169,144,169,133,81,86,184,15,70,29,240,122,56,125,184,128,148,57,228,137,189,114,97,38,151,71,52,193,204,114,56,77,146,202,216,175,57,191,3,194,248,240,62,6,95,194,252,167,229,191,197,63,147,145,229,116,116,185,72,156,199,89,163,143,73,151,184,151,155,125,247,20,197,71,0,101,99,67,171,244,157,182,129,242,...],
      "filename": "image1.jpg"
    }
  ]
}
```

Стало:
```
2025-04-13 02:50:31 [INFO]: ctx.session {
  "images": [
    {
      "filename": "image1.jpg",
      "bufferSize": 2048000,
      "hasBuffer": true
    }
  ]
}
```

## Рекомендации

1. **Всегда используйте `logSessionSafely`** для логирования session объектов
2. **Избегайте прямого логирования** `response.data` от API - используйте логирование метаданных
3. **Для больших объектов** создавайте краткие описания вместо полного дампа

## Миграция существующего кода

Найдите и замените:
- `console.log(ctx.session` → `logSessionSafely(ctx.session`
- `console.log(response.data` → логирование метаданных
- `console.log(largeObject` → `safeConsoleLog(largeObject` 