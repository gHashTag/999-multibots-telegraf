FROM node:20

WORKDIR /app

# Install system dependencies
RUN apt-get update && apt-get install -y \
    python3 \
    python3-pip \
    docker.io \
    docker-compose \
    build-essential \
    python3-dev \
    && rm -rf /var/lib/apt/lists/*

# Copy package files
COPY package*.json ./
COPY pnpm-lock.yaml ./

# Install dependencies
RUN npm install -g pnpm
RUN pnpm install

# Copy configuration files
COPY .env .env
COPY src ./src
COPY tsconfig.json ./
COPY .swcrc ./

# Build the application using swc
RUN pnpm run build

# Set up module resolution paths
ENV NODE_PATH=/app/dist
ENV TS_NODE_BASEURL=/app

# Create proper directory structure in dist
RUN mkdir -p dist/utils && \
    cp -r src/utils/* dist/utils/

# Expose MCP server port
EXPOSE 3000

# Start MCP server with proper module resolution
CMD ["node", "dist/bot.js"] 