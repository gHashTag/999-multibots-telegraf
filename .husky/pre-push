#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—É—â—É—é –∏ —É–¥–∞–ª–µ–Ω–Ω—É—é –≤–µ—Ç–∫—É, –∞ —Ç–∞–∫–∂–µ ref
current_branch=$(git rev-parse --abbrev-ref HEAD)
remote_branch=$(git rev-parse --abbrev-ref --symbolic-full-name @{u} 2>/dev/null | sed 's#^.*/##') # –ü–æ–ª—É—á–∞–µ–º –∏–º—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–µ—Ç–∫–∏

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Ü–µ–ª–µ–≤–∞—è –≤–µ—Ç–∫–∞ 'main'
if [ "$remote_branch" = "main" ]; then
  echo "üßò‚Äç‚ôÇÔ∏è –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –ø–æ–ø—ã—Ç–∫–∞ push –≤ 'main'. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ TypeScript (tsc --noEmit)..."
  pnpm exec tsc --noEmit
  exit_code=$?

  if [ $exit_code -ne 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–∞. Push –≤ 'main' –æ—Ç–º–µ–Ω–µ–Ω."
    echo "üïâÔ∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø—Ä–∞–≤—å—Ç–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –ø–µ—Ä–µ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–ø—ã—Ç–∫–æ–π."
    exit 1
  else
    echo "‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ TypeScript —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–∞ –¥–ª—è –≤–µ—Ç–∫–∏ 'main'."
  fi
else
  echo "push –Ω–µ –≤ 'main' ($remote_branch), –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —Ö—É–∫–æ–º pre-push."
fi

exit 0 