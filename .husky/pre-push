#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "[Husky pre-push] –í–†–ï–ú–ï–ù–ù–û –û–¢–ö–õ–Æ–ß–ï–ù–ê –ü–†–û–í–ï–†–ö–ê –î–õ–Ø PUSH –í MAIN!"
exit 0 # <--- –î–û–ë–ê–í–õ–Ø–ï–ú –≠–¢–£ –°–¢–†–û–ö–£ –î–õ–Ø –í–†–ï–ú–ï–ù–ù–û–ì–û –û–¢–ö–õ–Æ–ß–ï–ù–ò–Ø

# –ó–∞—â–∏—â–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞
protected_branch="main"

echo "[Husky pre-push] –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ç–∫–∏ –ø–µ—Ä–µ–¥ push..."

# –ß–∏—Ç–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –≤–≤–æ–¥ –æ—Ç Git (–ª–æ–∫–∞–ª—å–Ω–∞—è –≤–µ—Ç–∫–∞, –ª–æ–∫–∞–ª—å–Ω—ã–π sha, —É–¥–∞–ª–µ–Ω–Ω–∞—è –≤–µ—Ç–∫–∞, —É–¥–∞–ª–µ–Ω–Ω—ã–π sha)
while read local_ref local_sha remote_ref remote_sha; do
  # –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –≤–µ—Ç–∫–∏
  remote_branch=$(echo "$remote_ref" | sed 's!refs/heads/!!')
  echo "[Husky pre-push] –ü–æ–ø—ã—Ç–∫–∞ push –≤ —É–¥–∞–ª–µ–Ω–Ω—É—é –≤–µ—Ç–∫—É: $remote_branch"

  # –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–≤–ø–∞–¥–∞–µ—Ç –ª–∏ —Å –∑–∞—â–∏—â–µ–Ω–Ω–æ–π –≤–µ—Ç–∫–æ–π
  if [ "$remote_branch" = "$protected_branch" ]; then
    echo "
‚õîÔ∏è‚õîÔ∏è‚õîÔ∏è –û–®–ò–ë–ö–ê: –ü—Ä—è–º–æ–π push –≤ –≤–µ—Ç–∫—É '$protected_branch' –ó–ê–ü–†–ï–©–ï–ù! ‚õîÔ∏è‚õîÔ∏è‚õîÔ∏è
" >&2
    echo "üí° –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–æ–∑–¥–∞–π—Ç–µ Pull Request –¥–ª—è –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ '$protected_branch'." >&2
    exit 1 # –ó–∞–ø—Ä–µ—â–∞–µ–º push
  fi
done

echo "[Husky pre-push] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–π–¥–µ–Ω–∞. Push —Ä–∞–∑—Ä–µ—à–µ–Ω."
exit 0 # –†–∞–∑—Ä–µ—à–∞–µ–º push