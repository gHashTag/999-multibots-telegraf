---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –ü—Ä–∞–≤–∏–ª–æ: –ù–µ–ø—Ä–µ—Ä—ã–≤–Ω–∞—è –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏ –î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü—É—Ç—å –ø–æ–∑–Ω–∞–µ—Ç—Å—è –∏–¥—É—â–∏–º, –∞ –ø–ª–∞–Ω –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –¥–≤–∏–∂–µ–Ω–∏–∏.

1.  **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ü–æ—Å–ª–µ –ò—Ç–µ—Ä–∞—Ü–∏–∏:** –ü–æ—Å–ª–µ **–∫–∞–∂–¥–æ–π** –∏—Ç–µ—Ä–∞—Ü–∏–∏ (–ª–æ–≥–∏—á–µ—Å–∫–æ–≥–æ —à–∞–≥–∞, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ—à–∏–±–∫–∏ –∏ —Ç.–¥.) **–ù–ï–û–ë–•–û–î–ò–ú–û** –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–µ—Ä–µ—á–∏—Ç–∞—Ç—å –∏ **–æ–±–Ω–æ–≤–∏—Ç—å** —ç—Ç–æ—Ç —Ñ–∞–π–ª (`current_task.mdc`), –æ—Ç–º–µ—Ç–∏–≤ –ø—Ä–æ–≥—Ä–µ—Å—Å (‚úÖ, ‚è≥, ‚ùå) –∏ —Ç–æ—á–Ω–æ —É–∫–∞–∑–∞–≤ **—Å–ª–µ–¥—É—é—â–∏–π –∞–∫—Ç–∏–≤–Ω—ã–π —à–∞–≥**.
2.  **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –ü—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–π:** –ï—Å–ª–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —à–∞–≥–∞ –≤—Å—Ç—Ä–µ—á–∞–µ—Ç **–Ω–µ–ø—Ä–µ–æ–¥–æ–ª–∏–º–æ–µ –ø—Ä–µ–ø—è—Ç—Å—Ç–≤–∏–µ** –∏–ª–∏ –∑–∞–¥–∞—á–∞ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ, —á–µ–º –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–ª–æ—Å—å, **–ù–ï–û–ë–•–û–î–ò–ú–û**:
    *   –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä—è–º–æ–≥–æ —Ä–µ—à–µ–Ω–∏—è.
    *   **–î–µ–∫–æ–º–ø–æ–∑–∏—Ä–æ–≤–∞—Ç—å** –ø—Ä–æ–±–ª–µ–º—É –Ω–∞ –±–æ–ª–µ–µ –º–µ–ª–∫–∏–µ, —É–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ø–æ–¥–∑–∞–¥–∞—á–∏.
    *   –ü—Ä–µ–¥–ª–æ–∂–∏—Ç—å –ì—É—Ä—É **–Ω—É–º–µ—Ä–æ–≤–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (1, 2, 3...)** –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π –∏–ª–∏ –ø–æ–¥—Ö–æ–¥–æ–≤ –∫ —Ä–µ—à–µ–Ω–∏—é –ø–æ–¥–∑–∞–¥–∞—á.
3.  **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ü—Ä–æ–≥—Ä–µ—Å—Å–∞:** –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ `current_task.mdc` –≤—Å–µ–≥–¥–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∞ –ª—é–±–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å, –¥–∞–∂–µ —á–∞—Å—Ç–∏—á–Ω—ã–π, —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç—Å—è.

**–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω—É—é —è—Å–Ω–æ—Å—Ç—å –ø–ª–∞–Ω–∞, –≥–∏–±–∫–æ—Å—Ç—å –≤ —Ä–µ—à–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ, –¥–≤–∏–≥–∞—è—Å—å —à–∞–≥ –∑–∞ —à–∞–≥–æ–º (—Å—Ç–µ–ø-–±–∞–π-—Å—Ç–µ–ø) –∫ —Ü–µ–ª–∏.

*–û–º –®–∞–Ω—Ç–∏. –ü—É—Ç—å –≤ —Ç—ã—Å—è—á—É –ª–∏ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ –∏ —è—Å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞.* üôè

---

# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –ù–µ–π—Ä–æ–ö–æ–¥–µ—Ä - –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –Ø–¥—Ä–∞ –°—Ä–µ–¥—ã –∏ –ü–ª–∞–Ω –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è üßò‚Äç‚ôÇÔ∏è

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ö–∞–∫ –ª–æ—Ç–æ—Å —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ª–µ–ø–µ—Å—Ç–æ–∫ –∑–∞ –ª–µ–ø–µ—Å—Ç–∫–æ–º, —Ç–∞–∫ –∏ –º—ã –±—É–¥–µ–º –ø–æ–∫—Ä—ã–≤–∞—Ç—å –∫–æ–¥ —Ç–µ—Å—Ç–∞–º–∏, —Å–ª–µ–¥—É—è –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º—É –ø—É—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User Flow), –æ—Ç –∫–æ—Ä–Ω–µ–π –∫ —Ü–≤–µ—Ç–∞–º.

**–¶–µ–ª—å:** –î–æ–±–∏—Ç—å—Å—è üíØ% –ø–æ–∫—Ä—ã—Ç–∏—è –∫–æ–¥–∞ —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ `src` —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Vitest**, —Å–ª–µ–¥—É—è –ø—Ä–∏–Ω—Ü–∏–ø–∞–º TDD (üî¥ -> ‚úÖ -> ‚ôªÔ∏è), –ø–æ—Å–ª–µ —É–∫—Ä–µ–ø–ª–µ–Ω–∏—è —Å—Ä–µ–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** Vitest, `@vitest/ui` (–¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞: `pnpm test:ui`), `vi.mock` / `ts-mockito` (–¥–ª—è –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è).

**–õ–µ–≥–µ–Ω–¥–∞ –°—Ç–∞—Ç—É—Å–æ–≤:**
*   ‚úÖ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ
*   ‚è≥ - –í –†–∞–±–æ—Ç–µ
*   ‚ùå - –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ / –û—à–∏–±–∫–∞
*   üìù - –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ

---

## ‚öôÔ∏è P-1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¢–µ—Å—Ç–æ–≤–æ–≥–æ –û–∫—Ä—É–∂–µ–Ω–∏—è (Vitest)
*   **–°—Ç–∞—Ç—É—Å:** ‚úÖ (–ó–∞–≤–µ—Ä—à–µ–Ω–æ - —Å –æ–±—Ö–æ–¥–Ω—ã–º –ø—É—Ç–µ–º)
*   **–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ Vitest –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã.
*   **–ò—Ç–æ–≥:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –∞–≤—Ç–æ–æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ–º —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ `pnpm vitest run unit` –≤ –≤–æ—Ä–∫—Å–ø–µ–π—Å–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è. –û–¥–Ω–∞–∫–æ, –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –ø–æ –ø—Ä—è–º–æ–º—É –ø—É—Ç–∏ –∫ —Ñ–∞–π–ª—É (`pnpm vitest run <path/to/test.ts>`) —Ä–∞–±–æ—Ç–∞–µ—Ç. –ë—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –º–µ—Ç–æ–¥ –¥–ª—è –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –ø–æ –ø–ª–∞–Ω—É.

## üå± P-Core: –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ –Ø–¥—Ä–∞ –°—Ä–µ–¥—ã –†–∞–∑—Ä–∞–±–æ—Ç–∫–∏ (–ù–æ–≤—ã–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
*   **–°—Ç–∞—Ç—É—Å:** ‚è≥
*   **–¶–µ–ª—å:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –æ—Ç–ª–∞–¥–∫–∏ –∏ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞.
*   **–®–∞–≥–∏:**
    *   ‚úÖ –§–∏–∫—Å–∞—Ü–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Vitest (`git commit`).
    *   ‚úÖ **–ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ –±–∞–Ω–¥–ª–∞ (`rollup-plugin-visualizer`)**
        *   ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ `rollup-plugin-visualizer`.
        *   ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `vite.config.ts` –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤–∫–ª—é—á–µ–Ω–∏—è.
        *   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ `analyze:bundle` –≤ `package.json`.
    *   ‚è≥ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (`README.md` –∏–ª–∏ `docs/developer-guide.md`).
    *   üìù –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª–µ–¥—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–ø–æ —É–∫–∞–∑–∞–Ω–∏—é –ì—É—Ä—É).

## üó∫Ô∏è –ü—Ä–∏–æ—Ä–∏—Ç–µ–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ü–ª–∞–Ω –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è (User Flow)
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è P-Core)

### P0: –û—Å–Ω–æ–≤—ã - –í—Ö–æ–¥ –∏ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è (–í—ã—Å–æ—á–∞–π—à–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üî•
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –Ω–æ–≤—ã–π –∏ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É.
*   **User Flow:** `/start` -> `startScene`
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   üìù `src/registerCommands.ts` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è `/start`)
    *   ‚è≥ `src/scenes/startScene/index.ts` (–ª–æ–≥–∏–∫–∞ —Å—Ü–µ–Ω—ã)
        *   ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `processStartCommand` –∏ `startScene` –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
        *   ‚úÖ –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –Ω–∞ `startScene.test.ts` –∏ `processStartCommand.test.ts`.
    *   üìù `src/core/supabase/user.ts` (`createUser`)
    *   üìù `src/core/supabase/getUserDetailsSubscription.ts` (–ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è)
    *   üìù `src/core/supabase/referral.ts` (–±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ—Ñ–µ—Ä–∞–ª–æ–≤)
    *   üìù `src/utils/localization.ts` (`getTranslation`)
    *   üìù `src/menu/index.ts` (`startMenu`)
    *   üìù `src/menu/mainMenu.ts` (`levels` –¥–ª—è —Ç—É—Ç–æ—Ä–∏–∞–ª–∞)
    *   üìù `src/helpers/language.ts` (`isRussian`)
        *   ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Å—Å–µ—Ä—Ç–æ–≤ –≤ `support.test.ts`.

### P1: –ù–∞–≤–∏–≥–∞—Ü–∏—è - –ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é (–í—ã—Å–æ–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üß≠
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é –∏ –¥–æ—Å—Ç—É–ø –∫ –æ—Å–Ω–æ–≤–Ω—ã–º —Ä–∞–∑–¥–µ–ª–∞–º.
*   **User Flow:** `/menu` (–∏–ª–∏ –∫–Ω–æ–ø–∫–∞ "–ì–ª–∞–≤–Ω–æ–µ –ú–µ–Ω—é") -> `menuScene` -> –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ -> –ù–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ -> –ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥—Ä—É–≥—É—é —Å—Ü–µ–Ω—É/–∫–æ–º–∞–Ω–¥—É.
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   üìù `src/registerCommands.ts` (—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è `/menu`, –≥–ª–æ–±–∞–ª—å–Ω—ã–µ `hears`/`action`)
    *   üìù `src/scenes/menuScene/index.ts`
    *   üìù `src/menu/mainMenu.ts` (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã)
    *   üìù `src/core/supabase/getUserDetailsSubscription.ts` (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å–∫–∏ –¥–ª—è –º–µ–Ω—é)
    *   üìù `src/utils/localization.ts` (`getTranslation`)

### P2: –û—Å–Ω–æ–≤–Ω–æ–π –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ö–æ–Ω—Ç–µ–Ω—Ç–∞ (–°—Ä–µ–¥–Ω–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) ‚ú®
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—åÊ†∏ÂøÉ —Ñ—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞: –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏ –≤–∏–¥–µ–æ.
*   **User Flow (–ü—Ä–∏–º–µ—Ä –¥–ª—è Video):** –ö–Ω–æ–ø–∫–∞ "Video" -> –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ (`imageToVideoWizard` / `textToVideoWizard`) -> –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ -> –í–≤–æ–¥ –ø—Ä–æ–º–ø—Ç–∞/–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ -> –û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥ (`api-server`) -> (–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ) –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —á–µ—Ä–µ–∑ webhook -> –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   **–°—Ü–µ–Ω—ã:**
        *   üìù `src/scenes/imageToVideoWizard/index.ts`
        *   üìù `src/scenes/textToVideoWizard/index.ts`
        *   üìù `src/scenes/neuroPhotoWizard/index.ts` (–¥–ª—è —Ñ–æ—Ç–æ)
    *   **–õ–æ–≥–∏–∫–∞:**
        *   üìù `src/price/helpers/calculateFinalPrice.ts`
        *   üìù `src/price/constants/index.ts`
        *   üìù `src/config/models.config.ts`
        *   üìù `src/core/supabase/getUserBalance.ts`
        *   üìù `src/core/bot/index.ts` (–≤—ã–∑–æ–≤ API —Å–µ—Ä–≤–µ—Ä–∞)
    *   **–ú–µ–Ω—é:**
        *   üìù `src/menu/videoModelMenu.ts`
        *   üìù `src/menu/imageModelMenu.ts`
    *   **API –°–µ—Ä–≤–µ—Ä (`api-server`):**
        *   üìù –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (`/api/generate/*`)
        *   üìù –≠–Ω–¥–ø–æ–∏–Ω—Ç –≤–µ–±—Ö—É–∫–∞ Replicate (`/api/replicate-webhook`)
        *   üìù –õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å Replicate API.
        *   üìù –ú–µ—Ö–∞–Ω–∏–∑–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞.

### P3: –ú–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—è - –û–ø–ª–∞—Ç–∞ –∏ –ü–æ–¥–ø–∏—Å–∫–∏ (–°—Ä–µ–¥–Ω–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üí≥
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –û–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –ø–æ–∫—É–ø–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –ø–æ–ø–æ–ª–Ω–µ–Ω–∏—è –±–∞–ª–∞–Ω—Å–∞.
*   **User Flow:** –ö–Ω–æ–ø–∫–∞ "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" -> `paymentScene` -> –í—ã–±–æ—Ä –º–µ—Ç–æ–¥–∞ -> `starPaymentScene`/`rublePaymentScene` -> –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞ -> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `payments_v2` -> –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞.
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   **–°—Ü–µ–Ω—ã:**
        *   üìù `src/scenes/paymentScene/index.ts`
        *   üìù `src/scenes/starPaymentScene/index.ts`
        *   üìù `src/scenes/rublePaymentScene/index.ts`
    *   **–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:**
        *   üìù `src/handlers/paymentHandlers/index.ts` (`handleSuccessfulPayment` –¥–ª—è TG Stars)
    *   **–ë–∞–∑–∞ –î–∞–Ω–Ω—ã—Ö –∏ –õ–æ–≥–∏–∫–∞:**
        *   üìù `src/core/supabase/payments.ts` (—Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å `payments_v2`)
        *   üìù `src/core/supabase/getUserDetailsSubscription.ts`
        *   üìù `src/core/supabase/getUserBalance.ts`
        *   üìù SQL —Ñ—É–Ω–∫—Ü–∏–∏ (`get_user_balance`, `create_system_payment`)
    *   **API –°–µ—Ä–≤–µ—Ä (`api-server`):**
        *   üìù –≠–Ω–¥–ø–æ–∏–Ω—Ç Robokassa (`/api/robokassa-result`)
        *   üìù –ó–∞–≥–ª—É—à–∫–∏/—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `updateUserBalance`, `updateUserSubscription`.

### P4: –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –§—É–Ω–∫—Ü–∏–∏ (–ù–∏–∑–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üõ†Ô∏è
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –±–∞–ª–∞–Ω—Å–∞ –∏ —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.
*   **User Flow:** `/balance`, `/help`, `/support`, `/referral` -> –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ —Å—Ü–µ–Ω—ã/–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏.
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   üìù `src/scenes/balanceScene/index.ts`
    *   üìù `src/scenes/helpScene/index.ts`
    *   üìù `src/commands/support.command.ts`
    *   üìù `src/commands/referral.command.ts`
    *   üìù `src/core/supabase/referral.ts`

### P5: –ê–¥–º–∏–Ω-–§—É–Ω–∫—Ü–∏–∏ (–°–∞–º—ã–π –ù–∏–∑–∫–∏–π –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç) üîí
*   **–°—Ç–∞—Ç—É—Å:** üìù (–ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
*   **–¶–µ–ª—å:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—ã, –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º.
*   **–ö–ª—é—á–µ–≤—ã–µ –ú–æ–¥—É–ª–∏/–§–∞–π–ª—ã:**
    *   üìù `src/commands/admin/*`
    *   üìù `src/core/middlewares/admin.middleware.ts`

---

**–°–ª–µ–¥—É—é—â–∏–π –®–∞–≥:** –ó–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `rollup-plugin-visualizer` –∏ —Å–∫—Ä–∏–ø—Ç `analyze:bundle` (‚è≥ –≤ **P-Core**). –ñ–¥—É —Ä–µ—à–µ–Ω–∏—è –ì—É—Ä—É –æ –º–µ—Å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
