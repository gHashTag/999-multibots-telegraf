---
description: 
globs: 
alwaysApply: false
---
# üïâÔ∏è User Flow: /start Command

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü–æ–Ω–∏–º–∞–Ω–∏–µ –ø—É—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (User Flow) - –∫–ª—é—á –∫ —Å–æ–∑–¥–∞–Ω–∏—é –≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–≥–æ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞.

**–¢—Ä–∏–≥–≥–µ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—É `/start` –±–æ—Ç—É.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1.  **–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ö–æ–º–∞–Ω–¥—ã:** –ö–æ–º–∞–Ω–¥–∞ `/start` —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è –≤ [`@src/registerCommands.ts`](mdc:src/registerCommands.ts).
2.  **–í—Ö–æ–¥ –≤ –°—Ü–µ–Ω—É:** –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —Å—Ü–µ–Ω–∞ `startScene` ([`@src/scenes/startScene/index.ts`](mdc:src/scenes/startScene/index.ts)).
3.  **–ü–æ–ª—É—á–µ–Ω–∏–µ –î–∞–Ω–Ω—ã—Ö:** –ò–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (`ctx`) –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —è–∑—ã–∫ –∏ —Ç.–¥.
4.  **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `getUserDetailsSubscription` ([`@src/core/supabase/getUserDetailsSubscription.ts`](mdc:src/core/supabase/getUserDetailsSubscription.ts)) –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–æ–ª—É—á–µ–Ω–∏—è –µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞.
5.  **–ù–æ–≤—ã–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`userDetails.isExist === false`):
    *   **–†–µ—Ñ–µ—Ä–∞–ª:** –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `ctx.session.inviteCode`.
    *   **–î–∞–Ω–Ω—ã–µ –†–µ—Ñ–µ—Ä–µ—Ä–∞:** –ï—Å–ª–∏ –∫–æ–¥ –µ—Å—Ç—å, –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è `getReferalsCountAndUserData` ([`@src/core/supabase/referral.ts`](mdc:src/core/supabase/referral.ts)).
    *   **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:** –û—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è —Ä–µ—Ñ–µ—Ä–µ—Ä—É –∏/–∏–ª–∏ –∞–¥–º–∏–Ω—É (`ctx.telegram.sendMessage`).
    *   **–°–æ–∑–¥–∞–Ω–∏–µ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `createUser` ([`@src/core/supabase/user.ts`](mdc:src/core/supabase/user.ts)) –¥–ª—è –∑–∞–ø–∏—Å–∏ –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –ë–î.
    *   **–°–æ–æ–±—â–µ–Ω–∏–µ –æ –°–æ–∑–¥–∞–Ω–∏–∏:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é (`ctx.reply`).
6.  **–°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å (`userDetails.isExist === true`):
    *   **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ:** –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –∞–¥–º–∏–Ω—É –æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.
7.  **–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ:**
    *   –í—ã–∑—ã–≤–∞–µ—Ç—Å—è `getTranslation` ([`@src/utils/localization.ts`](mdc:src/utils/localization.ts)) —Å –∫–ª—é—á–æ–º `'start'`.
    *   –ï—Å–ª–∏ `url` –ø–æ–ª—É—á–µ–Ω, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ñ–æ—Ç–æ —Å –ø–æ–¥–ø–∏—Å—å—é (`ctx.replyWithPhoto`).
    *   –ï—Å–ª–∏ `url` –ø—É—Å—Ç, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ (`ctx.reply`).
8.  **–¢—É—Ç–æ—Ä–∏–∞–ª –∏ –ú–µ–Ω—é:**
    *   –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ URL —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –±–æ—Ç–∞ –≤ `BOT_URLS` ([`@src/core/bot/index.ts`](mdc:src/core/bot/index.ts)).
    *   **–ï—Å–ª–∏ URL –µ—Å—Ç—å:**
        *   –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è —Ç–µ–∫—Å—Ç —Ç—É—Ç–æ—Ä–∏–∞–ª–∞ (—Å —É—á–µ—Ç–æ–º —è–∑—ã–∫–∞ —á–µ—Ä–µ–∑ `isRussian` ([`@src/helpers/language.ts`](mdc:src/helpers/language.ts))).
        *   –§–æ—Ä–º–∏—Ä—É–µ—Ç—Å—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ —Å –∫–Ω–æ–ø–∫–∞–º–∏ "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É" –∏ "–¢–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–∞" (—Ç–µ–∫—Å—Ç –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —è–∑—ã–∫–∞, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `levels` –∏–∑ [`@src/menu/mainMenu.ts`](mdc:src/menu/mainMenu.ts)).
        *   –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ —Å —Ç—É—Ç–æ—Ä–∏–∞–ª–æ–º –∏ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π (`ctx.reply`).
    *   **–ï—Å–ª–∏ URL –Ω–µ—Ç:**
        *   –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ `startMenu` ([`@src/menu/index.ts`](mdc:src/menu/index.ts)).
        *   –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:" —Å —ç—Ç–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π (`ctx.reply`).
9.  **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:** –°—Ü–µ–Ω–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è (`ctx.scene.leave()`).

**–ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
*   Supabase (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Ä–µ—Ñ–µ—Ä–∞–ª—ã)
*   –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è (`getTranslation`)
*   –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ (`BOT_URLS`)
*   –ú–µ–Ω—é (`levels`, `startMenu`)
*   –•–µ–ª–ø–µ—Ä—ã (`isRussian`)

---
*–û–º –®–∞–Ω—Ç–∏. –ü—É—Å—Ç—å –ø—É—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±—É–¥–µ—Ç —è—Å–µ–Ω –∏ –ø—Ä—è–º.* üôè
