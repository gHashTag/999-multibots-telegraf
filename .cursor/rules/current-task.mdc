---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: ‚ú® –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –°–µ—Ä–≤–∏—Å–æ–≤ + üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ Plan B

*   **–°—Ç—Ä–∞—Ç–µ–≥–∏—è:** –í—Å—è –ª–æ–≥–∏–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ª–æ–∫–∞–ª—å–Ω–æ**. –§—É–Ω–∫—Ü–∏–∏ –≤ `src/services/plan_b` - —ç—Ç–∞–ª–æ–Ω–Ω—ã–µ –ª–æ–∫–∞–ª—å–Ω—ã–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –°–µ—Ä–≤–∏—Å—ã *–≤–Ω–µ* `plan_b`, –≤—ã–∑—ã–≤–∞—é—â–∏–µ `API_URL`, –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ `plan_b`.
*   **üíæ –ü—Ä–∞–≤–∏–ª–æ –ö–æ–º–º–∏—Ç–∞:** –ü–æ—Å–ª–µ **—É—Å–ø–µ—à–Ω–æ–≥–æ** –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–∞–∂–¥–æ–π –∑–Ω–∞—á–∏–º–æ–π –ø–æ–¥–∑–∞–¥–∞—á–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∏ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –æ–¥–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞) **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –≤—ã–ø–æ–ª–Ω—è—Ç—å `git add .` –∏ `git commit -m "..."` —Å –æ—Å–º—ã—Å–ª–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.
*   **–ö–æ–Ω—Ç–µ–∫—Å—Ç:**
    *   ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—è `api-server` –æ—Ç–º–µ–Ω–µ–Ω–∞.
    *   ‚úÖ –¢–µ—Å—Ç—ã –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã —Å Vitest –Ω–∞ Bun Test.
    *   ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–ª–∏—è–Ω–∏—è —Ä–∞–∑—Ä–µ—à–µ–Ω—ã.
    *   ‚ùå **–ë–õ–û–ö–ï–†:** –û—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –≤ `src/scenes/checkBalanceScene.ts` (*–ø–æ–∑–∂–µ*).
    *   ‚úÖ –í—ã—è–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã *–≤–Ω–µ* `plan_b`, –≤—ã–∑—ã–≤–∞—é—â–∏–µ `API_URL`:
        *   `src/services/generateVoiceAvatar.ts` (‚úÖ –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–µ–Ω -> `plan_b/createVoiceAvatar.ts`)
        *   `src/services/generateTextToImage.ts` (‚ùå –¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `plan_b` –≤–µ—Ä—Å–∏–∏)
        *   `src/services/generateTextToVideo.ts` (‚úèÔ∏è –û–∂–∏–¥–∞–µ—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞)
    *   ‚ùì `src/services/generateImageToVideo.ts` (‚ôªÔ∏è –¢—Ä–µ–±—É–µ—Ç –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏).
*   **–¢–µ–∫—É—â–∞—è –¶–µ–ª—å:**
    1.  ‚ú® –û—Ç—Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å –æ—Å—Ç–∞–≤—à–∏–µ—Å—è "–±—Ä–∞–∫–æ–≤–∞–Ω–Ω—ã–µ" —Å–µ—Ä–≤–∏—Å—ã (—Å–º. –≤—ã—à–µ).
    2.  üß™ **(–ê–∫—Ç–∏–≤–Ω–æ!)** –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ —Å–µ—Ä–≤–∏—Å—ã `src/services/plan_b` (TDD –ø–æ–¥—Ö–æ–¥).
*   **–ü–ª–∞–Ω –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞:**
    1.  ‚úÖ `src/services/generateVoiceAvatar.ts` -> `plan_b/createVoiceAvatar.ts`.
    2.  ‚ùå `src/services/generateTextToImage.ts` -> `plan_b/generateTextToImage.ts` (–¢—Ä–µ–±—É–µ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ Plan B).
    3.  ‚úèÔ∏è `src/services/generateTextToVideo.ts` -> `plan_b/generateTextToVideo.ts`.
    4.  ‚ôªÔ∏è `src/services/generateImageToVideo.ts` -> –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É (–≤–µ—Ä–æ—è—Ç–Ω–æ, —á–µ—Ä–µ–∑ `plan_b/generateImageToVideo.ts`?).
*   **–ü–ª–∞–Ω –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Plan B (TDD):**
    1.  ‚úÖ **–ê–Ω–∞–ª–∏–∑:** –ò–∑—É—á–µ–Ω —Å–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤ `plan_b`.
    2.  ‚úÖ **–ê–Ω–∞–ª–∏–∑ –í—ã–∑–æ–≤–æ–≤:** –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ - `plan_b` —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ.
    3.  ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¢–µ—Å—Ç–æ–≤:** –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è `src/__tests__/services/plan_b` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç.
    4.  ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `aiAssistantService.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
    5.  ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `notification.service.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
    6.  ‚ùå **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `avatar.service.ts`:** –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ –æ—à–∏–±–∫–∞–º–∏ —Ç–∏–ø–æ–≤ TypeScript –≤ –º–æ–∫–∞—Ö –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ Bun Test. –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–≥–æ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ì—É—Ä—É.
        *   ‚úèÔ∏è –ò–∑—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å.
        *   ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞.
        *   ‚úèÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞–¥–∞—é—â–∏–π —Ç–µ—Å—Ç.
        *   (–î–∞–ª–µ–µ) –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/–∏—Å–ø—Ä–∞–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å.
    7.  ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `createVoiceAvatar.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
        *   ‚úÖ –ò–∑—É—á–µ–Ω —Å–µ—Ä–≤–∏—Å `src/services/plan_b/createVoiceAvatar.ts`.
        *   ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `src/__tests__/services/plan_b/createVoiceAvatar.test.ts`.
        *   ‚úÖ –ù–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã —Ç–µ—Å—Ç—ã (—É—Å–ø–µ—Ö, –Ω–µ –Ω–∞–π–¥–µ–Ω, –æ—à–∏–±–∫–∞ 11l, –æ—à–∏–±–∫–∞ supabase, level up, unexpected).
    8.  ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `generateSpeech.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
        *   ‚úÖ –ò–∑—É—á–µ–Ω –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å `src/services/plan_b/generateSpeech.ts`.
        *   ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `src/__tests__/services/plan_b/generateSpeech.test.ts`.
        *   ‚úÖ –ù–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ–π–¥–µ–Ω –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç (—É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π).
    9.  ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `generateLipSync.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
        *   ‚úÖ –ò–∑—É—á–µ–Ω —Å–µ—Ä–≤–∏—Å `src/services/plan_b/generateLipSync.ts`.
        *   ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `src/__tests__/services/plan_b/generateLipSync.test.ts`.
        *   ‚úÖ –ù–∞–ø–∏—Å–∞–Ω—ã –∏ –ø—Ä–æ–π–¥–µ–Ω—ã —Ç–µ—Å—Ç—ã (—É—Å–ø–µ—Ö, api fail status, api no id, axios fail, supabase fail).
    10. ‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `generateImageToPrompt.ts`:** –ó–∞–≤–µ—Ä—à–µ–Ω–æ.
        *   ‚úÖ –ò–∑—É—á–µ–Ω —Å–µ—Ä–≤–∏—Å `src/services/plan_b/generateImageToPrompt.ts`.
        *   ‚úÖ –°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `src/__tests__/services/plan_b/generateImageToPrompt.test.ts`.
        *   ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ –∏–º–ø–æ—Ä—Ç–∞ `User`.
        *   ‚úÖ –ù–∞–ø–∏—Å–∞–Ω –∏ –ø—Ä–æ–π–¥–µ–Ω –ø–µ—Ä–≤—ã–π —Ç–µ—Å—Ç (—É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π).
    11. ‚è≥ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `videoService.ts`:** –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ (–¥–æ–±–∞–≤–ª–µ–Ω –≤ –ø–ª–∞–Ω).
        *   ‚úèÔ∏è **(–ê–∫—Ç–∏–≤–Ω–æ!)** –ò–∑—É—á–∏—Ç—å —Å–µ—Ä–≤–∏—Å `src/services/plan_b/videoService.ts`.
        *   ‚úèÔ∏è –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª —Ç–µ—Å—Ç–∞ `src/__tests__/services/plan_b/videoService.test.ts`.
        *   ‚úèÔ∏è –ù–∞–ø–∏—Å–∞—Ç—å –ø–∞–¥–∞—é—â–∏–π —Ç–µ—Å—Ç.
*   **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –§–∞–π–ª—ã (–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥):**
    *   ‚úèÔ∏è `src/services/plan_b/videoService.ts` (–ò–∑—É—á–µ–Ω–∏–µ)
    *   ‚úèÔ∏è `src/__tests__/services/plan_b/videoService.test.ts` (–°–æ–∑–¥–∞–Ω–∏–µ)
    *   ‚úèÔ∏è `.cursor/rules/current-task.mdc` (–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
*   **–°—Ç–∞—Ç—É—Å:** ‚úÖ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `generateSpeech.ts` –∑–∞–≤–µ—Ä—à–µ–Ω–æ. ‚ùå –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `avatar.service.ts` –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ. ‚è≥ –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é `videoService.ts`.

---
*–û–º –®–∞–Ω—Ç–∏. –¶–∏–∫–ª TDD –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è.* üôè
