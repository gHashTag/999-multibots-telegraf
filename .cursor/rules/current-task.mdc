---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –í–µ—Ç–∫–∏ –ü–æ—Å–ª–µ –°–ª–∏—è–Ω–∏—è `main`

## ‚ö†Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç:
*   –í–µ—Ç–∫–∞ `main` –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ —Å–ª–∏—Ç–∞ –≤ `test-image-to-video`.
*   –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø—Ä–æ—Ö–æ–¥–∏—Ç (`bun exec tsc --noEmit`).
*   **–¢–µ—Å—Ç—ã –ù–ï –ø—Ä–æ—Ö–æ–¥—è—Ç:**
    *   `calculator.test.ts`: –ó–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑-–∑–∞ –ø—Ä–æ–±–ª–µ–º —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ–º –º–æ–¥—É–ª–µ–π/–æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ç–µ—Å—Ç–æ–≤.
    *   –¢–µ—Å—Ç—ã Supabase (`common-scenarios`, `morphing-mode`, `standard-mode`, `generateTextToVideo`): –ü–∞–¥–∞—é—Ç —Å `TypeError: Invalid URL` –∏–∑-–∑–∞ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã—Ö/–æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö `SUPABASE_URL`/`SUPABASE_SERVICE_KEY` –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

## üõë –ü—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ó–∞–¥–∞—á–∏ (–∏–∑-–∑–∞ —Å–ª–∏—è–Ω–∏—è –∏ –ø—Ä–æ–±–ª–µ–º —Å —Ç–µ—Å—Ç–∞–º–∏):
*   ‚è∏Ô∏è –û—Ç–ª–∞–¥–∫–∞ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è `generateImageToVideo`.
*   ‚è∏Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ "–§–æ—Ç–æ –≤ –í–∏–¥–µ–æ" (`generateImageToVideo`).
*   ‚è∏Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ü–µ–Ω—ã `textToVideoWizard`.
*   ‚è∏Ô∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞ "–¢–µ–∫—Å—Ç –≤ –í–∏–¥–µ–æ" (`generateTextToVideo`).
*   ‚úèÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ –¥–ª—è `calculator.test.ts` (–û—Ç–ª–æ–∂–µ–Ω–æ).

## ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ —à–∞–≥–∏ —Å–ª–∏—è–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ —Ç–µ—Å—Ç–æ–≤:
*   ‚úÖ –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∞ —Ä–∞–±–æ—á–∞—è –≤–µ—Ç–∫–∞ (`test-image-to-video`).
*   ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ —Å–ª–∏—è–Ω–∏–µ (`git merge main`).
*   ‚úÖ –ö–æ–Ω—Ñ–ª–∏–∫—Ç –≤ `current-task.mdc` —Ä–∞–∑—Ä–µ—à–µ–Ω –∏ –∑–∞–∫–æ–º–º–∏—á–µ–Ω.
*   ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –ø–æ—Å–ª–µ —Å–ª–∏—è–Ω–∏—è —É—Å–ø–µ—à–Ω–∞.
*   ‚úÖ –ü—Ä–æ–±–ª–µ–º—ã –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ (`ERR_REQUIRE_ESM`, `Cannot find module`) –æ–±–æ–π–¥–µ–Ω—ã (–æ—Ç–∫–∞—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, –ø—Ä–∞–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤, –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ `calculator.test.ts`).
*   ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω —Å–∫—Ä–∏–ø—Ç `test:vitest` —Å `cross-env` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö Supabase.

## ‚úèÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –¢–µ—Å—Ç–æ–≤–æ–≥–æ –û–∫—Ä—É–∂–µ–Ω–∏—è (–ú–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ Supabase)

**–¶–µ–ª—å:** –î–æ–±–∏—Ç—å—Å—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤ (–∏–ª–∏ –ø–æ–Ω—è—Ç–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ) —á–µ—Ä–µ–∑ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Supabase.

**–ü–ª–∞–Ω:**
1.  ‚úÖ **–ê–Ω–∞–ª–∏–∑:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `.env` –¥–ª—è —Ç–µ—Å—Ç–æ–≤ —Ä–∏—Å–∫–æ–≤–∞–Ω–Ω–æ. –û—à–∏–±–∫–∞ `Invalid URL` –≤—ã–∑–≤–∞–Ω–∞ –ø–æ–ø—ã—Ç–∫–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –±–µ–∑ –≤–∞–ª–∏–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.
2.  ‚úèÔ∏è **(–ê–ö–¢–ò–í–ù–û)** **–†–µ—à–µ–Ω–∏–µ:** –ú–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç Supabase (`src/core/supabase/client.ts`) –≤ —Ç–µ—Å—Ç–∞—Ö —Å –ø–æ–º–æ—â—å—é `vi.mock`.
3.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –º–æ–∫ –¥–ª—è `supabase` –≤ –æ–¥–Ω–æ–º –∏–∑ –ø–∞–¥–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `common-scenarios.test.ts`).
4.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã (`pnpm vitest run`) –∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∏—Å—á–µ–∑–ª–∞ –ª–∏ –æ—à–∏–±–∫–∞ Supabase –≤ —ç—Ç–æ–º —Ñ–∞–π–ª–µ.
5.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –ï—Å–ª–∏ –®–∞–≥ 4 —É—Å–ø–µ—à–µ–Ω, –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º —Ç–µ—Å—Ç–∞–º, –∑–∞–≤–∏—Å–∏–º—ã–º –æ—Ç Supabase.
6.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –†–∞–∑–æ–±—Ä–∞—Ç—å—Å—è —Å `calculator.test.ts` (–æ—Å—Ç–∞–≤–∏—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∏–ª–∏ –∏—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã).
7.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –ï—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥—É—Ç (–∏–ª–∏ –±—É–¥—É—Ç –ø–∞–¥–∞—Ç—å –ø–æ –∏–∑–≤–µ—Å—Ç–Ω—ã–º –ø—Ä–∏—á–∏–Ω–∞–º), —Å—á–∏—Ç–∞—Ç—å –≤–µ—Ç–∫—É —É—Å–ª–æ–≤–Ω–æ —Å—Ç–∞–±–∏–ª—å–Ω–æ–π.
8.  ‚úèÔ∏è **(–ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ)** –ü–µ—Ä–µ–π—Ç–∏ –∫ —É—Ç–æ—á–Ω–µ–Ω–∏—é –¥–µ—Ç–∞–ª–µ–π "–Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏".

**–°–ª–µ–¥—É—é—â–∏–π –®–∞–≥:**
*   ü§î **(–ê–ö–¢–ò–í–ù–û)** –ì—É—Ä—É –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏—è Supabase –¥–ª—è —Ç–µ—Å—Ç–æ–≤.
