---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¶–µ–Ω –∏ –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –û—à–∏–±–æ–∫ –¢–∏–ø–æ–≤ ‚úÖ

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ü—Ä–∏–≤–µ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—É —Ü–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –∏ –¢–ó, –∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤–æ–∑–Ω–∏–∫—à–∏–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –∏ –æ–±–µ—Å–ø–µ—á–∏—Ç—å —á–∏—Å—Ç–æ—Ç—É –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã.

**–¶–µ–ª—å:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è –∫–æ–¥–æ–≤–∞—è –±–∞–∑–∞ —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π, —Ö–æ—Ç—è –∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–∞—á–µ–Ω–Ω–æ–π, –ª–æ–≥–∏–∫–æ–π —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω –∏ –±–µ–∑ –æ—à–∏–±–æ–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏.

**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, TypeScript, –ü—Ä–∞–≤–∏–ª–∞ (`price-calculation-consistency.mdc`, `pricing_refactoring_tz`), Git.

**–õ–µ–≥–µ–Ω–¥–∞ –°—Ç–∞—Ç—É—Å–æ–≤:**
*   ‚úÖ - –ó–∞–≤–µ—Ä—à–µ–Ω–æ
*   ‚è≥ - –í –†–∞–±–æ—Ç–µ
*   ‚ùå - –ë–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ / –û—à–∏–±–∫–∞
*   üìù - –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ
*   ‚è™ - –û—Ç–∫–∞—á–µ–Ω–æ / –í—Ä–µ–º–µ–Ω–Ω–æ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–æ

---

## üó∫Ô∏è –ü–ª–∞–Ω –†–∞–±–æ—Ç (–ò—Ç–µ—Ä–∞—Ü–∏—è N+1 - –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è)

### P1: –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ö–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –°–ª–∏—è–Ω–∏—è
*   **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ

### P2: –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –°–∏—Å—Ç–µ–º—ã –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è
*   **–°—Ç–∞—Ç—É—Å:** ‚è™ –í—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–∞—á–µ–Ω–∞ —á–∞—Å—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–π (–¥–ª—è `calculateFinalStarPrice`)
*   **–¶–µ–ª—å:** –ò–∑–Ω–∞—á–∞–ª—å–Ω–æ - –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –¢–ó. –¢–µ–∫—É—â–∞—è - —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥.
*   **–ö–ª—é—á–µ–≤—ã–µ –ó–∞–¥–∞—á–∏ (–∏–∑ –¢–ó):**
    *   ‚úÖ **–®–∞–≥ 1-3 (—á–∞—Å—Ç–∏—á–Ω–æ):** `calculateFinalPrice` –≤ `helpers` –±—ã–ª–∞ –æ—Ç–∫–∞—á–µ–Ω–∞ –∫ –≤–µ—Ä—Å–∏–∏, –ø—Ä–∏–Ω–∏–º–∞—é—â–µ–π `modelId` (string) –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–µ–π `number` –¥–ª—è —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤. –ù–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ –≤ `pricing.config.ts` –∏ `src/price/calculator.ts` –ø–æ–∫–∞ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Å–Ω–æ–≤–Ω–æ–π —Å—Ü–µ–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–ª–∞–Ω—Å–∞.
    *   ‚úÖ **–®–∞–≥ 4-6:** –ú–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å—Ç–∞—Ä–æ–π –ª–æ–≥–∏–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `modeCosts`) –≤ `checkBalanceScene.ts` –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ç–∫–∞—á–µ–Ω–Ω–æ–π `calculateFinalPrice`.
    *   üìù **–®–∞–≥ 7:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ø–∏—Å–∞–Ω–∏–µ –∑–≤–µ–∑–¥ –≤ `enterTargetScene` (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏).
    *   üìù **–®–∞–≥ 8:** –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –ø–æ —Ü–µ–Ω–∞–º (—Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞ –∏–∑-–∑–∞ –æ—Ç–∫–∞—Ç–∞).
*   **–í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è):**
    *   ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏ TypeScript, –≤–æ–∑–Ω–∏–∫—à–∏–µ –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Ü–µ–Ω –∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Å–ª–∏—è–Ω–∏—è.
    *   ‚úÖ –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å –Ω–µ–≤–µ—Ä–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º `calculateFinalStarPrice` –≤ `checkBalanceScene.ts`.
    *   ‚úÖ –ö–æ–¥ —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ—Ö–æ–¥–∏—Ç –ø—Ä–æ–≤–µ—Ä–∫—É —Ç–∏–ø–æ–≤ (`pnpm typecheck`).

### P3: –ù–∞–ø–∏—Å–∞–Ω–∏–µ –¢–µ—Å—Ç–æ–≤ –¥–ª—è –¶–µ–Ω
*   **–°—Ç–∞—Ç—É—Å:** üìù –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ (–ø–æ—Å–ª–µ P2, —Ç—Ä–µ–±—É–µ—Ç –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–∞ –∏–∑-–∑–∞ –æ—Ç–∫–∞—Ç–∞ –ª–æ–≥–∏–∫–∏)

### P4: –ó–∞–ø—É—Å–∫ –∏ –ü—Ä–æ–≤–µ—Ä–∫–∞ (`pnpm dev`)
*   **–°—Ç–∞—Ç—É—Å:** üìù –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥)
