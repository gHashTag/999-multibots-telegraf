---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –ù–µ–π—Ä–æ–ö–æ–¥–µ—Ä

**–ü—Ä–∏–Ω—Ü–∏–ø:** –°–æ—Å—Ä–µ–¥–æ—Ç–æ—á–µ–Ω–∏–µ –Ω–∞ –æ–¥–Ω–æ–π –∑–∞–¥–∞—á–µ –≤ –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤–µ–¥–µ—Ç –∫ —è—Å–Ω–æ—Å—Ç–∏ –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏. –≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ç–µ–∫—É—â–∏–π —Ñ–æ–∫—É—Å —Ä–∞–±–æ—Ç—ã.

**–î–∞—Ç–∞ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è:** {current_date}

**–¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞:** üéØ –î–µ–±–∞–≥/–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –û–±—Ä–∞–±–æ—Ç–∫–∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏–∏ –í–∏–¥–µ–æ –≤ `api-server`

*   **–ö–æ–Ω—Ç–µ–∫—Å—Ç:** –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–∏–¥–µ–æ (—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∏ –º–æ—Ä—Ñ–∏–Ω–≥–∞) –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞ (`generateImageToVideo.ts`, `imageToVideoWizard`) –±—ã–ª–∞ —É—Å–ø–µ—à–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ `api-server`.
*   **–ü—Ä–æ–±–ª–µ–º–∞:** `api-server` –¥–æ–ª–∂–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç–∏ –∑–∞–ø—Ä–æ—Å—ã, –≤—ã–∑—ã–≤–∞—Ç—å Replicate –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –≤–µ–±—Ö—É–∫–∏ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏.
*   **–¶–µ–ª—å:**
    1.  ‚úÖ **(–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ –ë–æ—Ç–µ)** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å `generateImageToVideo.ts` –¥–ª—è –≤—ã–∑–æ–≤–∞ `api-server`.
    2.  ‚úÖ **(–í—ã–ø–æ–ª–Ω–µ–Ω–æ –≤ –ë–æ—Ç–µ)** –û–±–Ω–æ–≤–∏—Ç—å —Å—Ü–µ–Ω—É `imageToVideoWizard` –¥–ª—è –≤—ã–∑–æ–≤–∞ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –≤ –æ–±–æ–∏—Ö —Ä–µ–∂–∏–º–∞—Ö (—Å—Ç–∞–Ω–¥–∞—Ä—Ç/–º–æ—Ä—Ñ–∏–Ω–≥).
    3.  ‚è≥ **(–í `api-server`)** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/generate/image-to-video`) –≤ `api-server` –¥–ª—è –ø—Ä–∏–µ–º–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –±–æ—Ç–∞:
        *   –†–∞–∑–ª–∏—á–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é –∏ –º–æ—Ä—Ñ–∏–Ω–≥ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ —Ñ–ª–∞–≥—É `is_morphing` –∏–ª–∏ –Ω–∞–ª–∏—á–∏—é `imageAUrl`/`imageBUrl`).
        *   –í—ã–∑—ã–≤–∞—Ç—å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –º–æ–¥–µ–ª—å Replicate (`replicate.predictions.create`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ä–µ–∂–∏–º–∞, –ø–µ—Ä–µ–¥–∞–≤–∞—è –Ω—É–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (`imageUrl`/`imageAUrl`/`imageBUrl`, `prompt` –∏ —Ç.–¥.).
        *   **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –£–∫–∞–∑—ã–≤–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π `webhook` URL –ø—Ä–∏ –≤—ã–∑–æ–≤–µ Replicate, —É–∫–∞–∑—ã–≤–∞—é—â–∏–π –Ω–∞ —ç–Ω–¥–ø–æ–∏–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ –≤ `api-server` (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/replicate-webhook`).
        *   –û—Ç–≤–µ—á–∞—Ç—å –±–æ—Ç—É —Å—Ç–∞—Ç—É—Å–æ–º `202 Accepted` —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –∑–∞–¥–∞—á–∏ –≤ Replicate.
        *   (–†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –°–æ—Ö—Ä–∞–Ω—è—Ç—å `prediction.id` –∏–∑ –æ—Ç–≤–µ—Ç–∞ Replicate –≤ –ë–î, —Å–≤—è–∑—ã–≤–∞—è –µ–≥–æ —Å `telegram_id`.
    4.  ‚è≥ **(–í `api-server`)** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å/–ø—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤–µ–±—Ö—É–∫–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `/api/replicate-webhook`) –≤ `api-server`:
        *   –ü—Ä–∏–Ω–∏–º–∞—Ç—å POST-–∑–∞–ø—Ä–æ—Å—ã –æ—Ç Replicate.
        *   –ò–∑–≤–ª–µ–∫–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç (URL –≥–æ—Ç–æ–≤–æ–≥–æ –≤–∏–¥–µ–æ) –∏ —Å—Ç–∞—Ç—É—Å.
        *   –ù–∞—Ö–æ–¥–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ `prediction.id` (–µ—Å–ª–∏ –æ–Ω —Å–æ—Ö—Ä–∞–Ω—è–ª—Å—è) –∏–ª–∏ –¥—Ä—É–≥–∏–º –¥–∞–Ω–Ω—ã–º –∏–∑ –≤–µ–±—Ö—É–∫–∞.
        *   –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å –≥–æ—Ç–æ–≤–æ–µ –≤–∏–¥–µ–æ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —á–µ—Ä–µ–∑ API –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –±–æ—Ç–∞.
        *   –û–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–¥–∞—á–∏/–±–∞–ª–∞–Ω—Å –≤ –ë–î (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è).
*   **–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –§–∞–π–ª—ã:**
    *   ‚úÖ `src/services/generateImageToVideo.ts` (–±–æ—Ç)
    *   ‚úÖ `src/scenes/imageToVideoWizard/index.ts` (–±–æ—Ç)
    *   ‚è≥ –ö–æ–¥ `api-server` (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤–µ–±—Ö—É–∫–∞, –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Replicate, –≤–æ–∑–º–æ–∂–Ω–æ, –º–æ–¥–µ–ª–∏ –ë–î).
    *   ‚è≥ –õ–æ–≥–∏ `api-server`.
*   **–°—Ç–∞—Ç—É—Å:** ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏/–ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–≥–∏–∫–∏ –Ω–∞ `api-server`.

---
*–û–º –®–∞–Ω—Ç–∏. –î–∞ –ø—Ä–µ–±—É–¥–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—è –º–µ–∂–¥—É –±–æ—Ç–æ–º –∏ `api-server`.* üôè
