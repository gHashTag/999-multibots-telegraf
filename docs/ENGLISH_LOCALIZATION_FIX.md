# –û—Ç—á–µ—Ç –æ–± –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞

## ‚úÖ –ü–†–û–ë–õ–ï–ú–ê –†–ï–®–ï–ù–ê

### üîç –ü—Ä–æ–±–ª–µ–º–∞:

–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ–±—Ä–∞—Ç–∏–ª –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –≤ –±–æ—Ç–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞:

> "–ê –ø–æ—á–µ–º—É –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ –Ω–µ—Ç—É? –ü–æ—á–µ–º—É —É –Ω–∞—Å —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π, —á—Ç–æ –ª–∏? –£ –Ω–∞—Å –∂–µ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —Ç–æ–∂–µ –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å."

### üîß –ê–Ω–∞–ª–∏–∑:

–ü—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –∫–æ–¥–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ, —á—Ç–æ —Ö–æ—Ç—è –≤ —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ —è–∑—ã–∫–∞ (`ctx.from?.language_code === 'ru'`), –Ω–æ:

1. **–°–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–µ—Ä–≤–∏—Å–æ–≤** –≤–æ–∑–≤—Ä–∞—â–∞–ª–∞ —Ç–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è
2. **–ü—Ä–æ–º–æ-—Å–∏—Å—Ç–µ–º–∞** –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–ª–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è  
3. **–ë–∞–ª–∞–Ω—Å-—Å—Ü–µ–Ω–∞** –∏–º–µ–ª–∞ —á–∞—Å—Ç–∏—á–Ω—É—é –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏—é
4. **–§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç** –±—ã–ª–æ —Ç–æ–ª—å–∫–æ –≤ —Ä—É—Å—Å–∫–æ–º —Ñ–æ—Ä–º–∞—Ç–µ

### üõ†Ô∏è –†–µ—à–µ–Ω–∏–µ:

#### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

**–§–∞–π–ª:** `src/utils/serviceMapping.ts`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `isRu: boolean = true` –≤ —Ñ—É–Ω–∫—Ü–∏—é `getServiceDisplayTitle`
- ‚úÖ –°–æ–∑–¥–∞–Ω—ã –ø–æ–ª–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º

```typescript
export function getServiceDisplayTitle(
  service: UserService, 
  description?: string, 
  isRu: boolean = true
): string {
  // –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  if (service === UserService.PaymentOperation && description) {
    const desc = description.toLowerCase()
    
    if (desc.includes('promo bonus')) {
      return isRu ? '–ü—Ä–æ–º–æ-–±–æ–Ω—É—Å' : 'Promo Bonus'
    }
    
    if (desc.includes('auto-activated subscription')) {
      return isRu ? '–ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∫–∏' : 'Subscription Activation'
    }
  }

  // –ü–æ–ª–Ω—ã–µ –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
  const titles = isRu ? titlesRu : titlesEn
  return titles[service] || titles[UserService.Unknown]
}
```

#### 2. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –ø—Ä–æ–º–æ-—Å–∏—Å—Ç–µ–º–∞

**–§–∞–π–ª:** `src/helpers/promoHelper.ts`

- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä `isRu: boolean = true` –≤ —Ñ—É–Ω–∫—Ü–∏—é `processPromoLink`
- ‚úÖ –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π —è–∑—ã–∫
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã –≤ `createUserScene.ts`

```typescript
export async function processPromoLink(
  telegram_id: string,
  promoParameter: string = '',
  bot_name: string = 'MetaMuse_Manifest_bot',
  isRu: boolean = true
): Promise<{ success: boolean; message: string; alreadyReceived?: boolean }> {
  // –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
  if (alreadyReceived) {
    return {
      success: false,
      message: isRu 
        ? '–í—ã —É–∂–µ –ø–æ–ª—É—á–∏–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ-–±–æ–Ω—É—Å!'
        : 'You have already received this promotional bonus!',
      alreadyReceived: true,
    }
  }

  if (success) {
    return {
      success: true,
      message: isRu
        ? `üéÅ –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π –±–æ–Ω—É—Å –ø–æ–ª—É—á–µ–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ ${starAmount} –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö –∑–≤–µ–∑–¥!`
        : `üéÅ Welcome bonus received! You got ${starAmount} free stars!`,
    }
  }
}
```

#### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –±–∞–ª–∞–Ω—Å-—Å—Ü–µ–Ω–∞

**–§–∞–π–ª:** `src/scenes/balanceScene/index.ts`

- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç –¥–ª—è –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–≤–æ–¥—ã –¥–ª—è –≤–∞–ª—é—Ç (—Ä—É–±. ‚Üí RUB)
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∫–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä —è–∑—ã–∫–∞ –≤ `getServiceDisplayTitle`

```typescript
// –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç
const date = new Date(payment.payment_date).toLocaleDateString(
  isRu ? 'ru-RU' : 'en-US'
)

// –í–∞–ª—é—Ç—ã
message += ` (${amount} ${isRu ? '—Ä—É–±.' : 'RUB'})`

// –ö–Ω–æ–ø–∫–∏
{
  text: isRu ? 'üìä –°–∫–∞—á–∞—Ç—å –¥–µ—Ç–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç Excel' : 'üìä Download detailed Excel report',
  callback_data: 'download_excel_report',
}

// –ù–∞–∑–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
const serviceTitle = getServiceDisplayTitle(
  service as UserService, 
  undefined, 
  isRu
)
```

#### 4. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–§–∞–π–ª:** `src/scenes/createUserScene.ts`

- ‚úÖ –£–ø—Ä–æ—â–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–º–æ-—Å–æ–æ–±—â–µ–Ω–∏–π
- ‚úÖ –ü–µ—Ä–µ–¥–∞–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä —è–∑—ã–∫–∞ –≤ `processPromoLink`
- ‚úÖ –£–±—Ä–∞–Ω—ã –¥—É–±–ª–∏—Ä—É—é—â–∏–µ—Å—è –ø–µ—Ä–µ–≤–æ–¥—ã

```typescript
const promoResult = await processPromoLink(
  telegram_id.toString(),
  promoInfo.parameter || '',
  ctx.botInfo.username,
  isRussian(ctx)  // –ü–µ—Ä–µ–¥–∞–µ–º —è–∑—ã–∫
)

// –ü—Ä–æ—Å—Ç–æ –≤—ã–≤–æ–¥–∏–º –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
await ctx.reply(promoResult.message)
```

### üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–°–æ–∑–¥–∞–Ω—ã –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏:

```bash
‚úì 20 pass, 0 fail (56 expect() calls)
```

**–ù–æ–≤—ã–µ —Ç–µ—Å—Ç—ã:**
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–æ–º–æ-—Å–∏—Å—Ç–µ–º–µ
- ‚úÖ –†—É—Å—Å–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ø—Ä–æ–º–æ-—Å–∏—Å—Ç–µ–º–µ  
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
- ‚úÖ –ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –†—É—Å—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### üìä –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —è–∑—ã–∫–∏:

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –†—É—Å—Å–∫–∏–π | –ê–Ω–≥–ª–∏–π—Å–∫–∏–π |
|-----------|---------|------------|
| –°–∏—Å—Ç–µ–º–∞ –º–∞–ø–ø–∏–Ω–≥–∞ —Å–µ—Ä–≤–∏—Å–æ–≤ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ–º–æ-—Å–∏—Å—Ç–µ–º–∞ | ‚úÖ | ‚úÖ |
| –ë–∞–ª–∞–Ω—Å-—Å—Ü–µ–Ω–∞ | ‚úÖ | ‚úÖ |
| –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç | ‚úÖ | ‚úÖ |
| –í–∞–ª—é—Ç—ã | ‚úÖ | ‚úÖ |
| –ö–Ω–æ–ø–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | ‚úÖ | ‚úÖ |

### üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:

–¢–µ–ø–µ—Ä—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –∞–Ω–≥–ª–∏–π—Å–∫–∏–º —è–∑—ã–∫–æ–º (`language_code !== 'ru'`) –≤–∏–¥—è—Ç:

**–ë–∞–ª–∞–Ω—Å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:**
```
üí∞ Your balance and statistics

üíé Current balance: 476 ‚≠ê

üìä Overall statistics:
   üìà Total top-ups: 476 ‚≠ê
   üéÅ Bonuses received: 476 ‚≠ê
   üìâ Total spent: 476 ‚≠ê
   üî¢ Total transactions: 2

üõ†Ô∏è Services breakdown:
   1. üí≥ Promo Bonus:
      üí∞ 476‚≠ê (50%)
      üî¢ 1 operations
   
   2. üí≥ Subscription Activation:
      üí∞ 476‚≠ê (50%)
      üî¢ 1 operations

üìà Recent top-ups:
   1. ‚≠ê 05/28/2025: 476‚≠ê (Telegram Stars)

üìâ Recent expenses:
   1. üìâ 05/28/2025: 476‚≠ê - üí≥ Subscription Activation
```

**–ü—Ä–æ–º–æ-—Å–æ–æ–±—â–µ–Ω–∏—è –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º:**
```
üéÅ Welcome bonus received! You got 476 free stars!
‚ö†Ô∏è You have already received this promotional bonus!
‚ùå Failed to process promotional bonus. Please try again later.
```

### üîÑ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:

- ‚úÖ –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ä—É—Å—Å–∫–∏–º —è–∑—ã–∫–æ–º
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —è–∑—ã–∫–∞ –ø–æ `language_code`
- ‚úÖ Fallback –Ω–∞ —Ä—É—Å—Å–∫–∏–π —è–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –ù–µ –Ω–∞—Ä—É—à–∞–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å

### üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:

**–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ —è–∑—ã–∫–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞!** üéâ

–¢–µ–ø–µ—Ä—å –±–æ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å –ª—é–±—ã–º —è–∑—ã–∫–æ–º:
- **–†—É—Å—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (`language_code === 'ru'`) –≤–∏–¥—è—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **–ê–Ω–≥–ª–∏–π—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏** (`language_code !== 'ru'`) –≤–∏–¥—è—Ç –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º
- **–í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏** —Ä–∞–±–æ—Ç–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤–æ –¥–ª—è –æ–±–µ–∏—Ö —è–∑—ã–∫–æ–≤—ã—Ö –≥—Ä—É–ø–ø 