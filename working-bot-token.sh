#!/bin/bash

# –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–æ–∫–µ–Ω –æ—Ç https://t.me/gdrive_bot
BOT_TOKEN="1059518956:AAGhFqhJh6N-e-0-KbgIJgJbq7RdIqrk-2c"
CHAT_ID="144022504"  # ID –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

echo "=== –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Ä–∞–±–æ—á–µ–≥–æ –±–æ—Ç–∞ ==="
echo "–¢–æ–∫–µ–Ω: $BOT_TOKEN"
echo "ID —á–∞—Ç–∞: $CHAT_ID"
echo

# –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –±–æ—Ç–µ
echo "–ó–∞–ø—Ä–æ—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±–æ—Ç–µ..."
bot_info=$(curl -s "https://api.telegram.org/bot$BOT_TOKEN/getMe")
echo "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ: $bot_info"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∞–ª–∏–¥–Ω—ã–π –ª–∏ —Ç–æ–∫–µ–Ω
if echo "$bot_info" | grep -q '"ok":true'; then
  echo "‚úÖ –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π"
  
  # –ü—Ä–æ–±—É–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ
  echo "–û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è..."
  message="üîÑ –¢–µ—Å—Ç —Å–∏—Å—Ç–µ–º—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π\n"
  message+="–í—Ä–µ–º—è: $(date "+%Y-%m-%d %H:%M:%S")\n"
  message+="–≠—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç —Å–∫—Ä–∏–ø—Ç–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.\n"
  message+="–ï—Å–ª–∏ –≤—ã –µ–≥–æ –ø–æ–ª—É—á–∏–ª–∏, –∑–Ω–∞—á–∏—Ç API Telegram —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ."
  
  send_result=$(curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
              -d "chat_id=$CHAT_ID" \
              -d "text=$message")
  
  echo "–†–µ–∑—É–ª—å—Ç–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏: $send_result"
  
  if echo "$send_result" | grep -q '"ok":true'; then
    echo "‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ!"
    
    # –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ —Ä–∞–±–æ—á–∏—Ö —Å–∫—Ä–∏–ø—Ç–∞—Ö
    echo "–û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–∫–µ–Ω –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö..."
    sed -i "s|BOT_TOKEN=\"[^\"]*\"|BOT_TOKEN=\"$BOT_TOKEN\"|g" /root/admin-pulse-notify.sh
    sed -i "s|BOT_TOKEN=\"[^\"]*\"|BOT_TOKEN=\"$BOT_TOKEN\"|g" /root/test-pulse-messages.sh
    
    echo "–¢–æ–∫–µ–Ω –æ–±–Ω–æ–≤–ª–µ–Ω –≤ —Å–∫—Ä–∏–ø—Ç–∞—Ö."
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º
    echo "–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Å –Ω–æ–≤—ã–º —Ç–æ–∫–µ–Ω–æ–º..."
    bash /root/test-pulse-messages.sh
  else
    echo "‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è"
    echo "–í–æ–∑–º–æ–∂–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞: –±–æ—Ç –Ω–µ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –∫–æ—Ç–æ—Ä—ã–π —Å –Ω–∏–º –Ω–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞–ª"
    echo "–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –æ—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç —Å –±–æ—Ç–æ–º @gdrive_bot –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –µ–º—É –ª—é–±–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"
  fi
else
  echo "‚ùå –ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π —Ç–æ–∫–µ–Ω"
fi

echo
echo "–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ." 