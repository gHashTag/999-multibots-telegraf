# Инструкция по системе уведомлений администратора

## Обзор системы

Система уведомлений выполняет следующие функции:
1. Ежечасно проверяет логи и статус контейнеров на сервере
2. При обнаружении ошибок отправляет уведомление администратору
3. При серьезных проблемах дублирует сообщение в канал @neuro_blogger_pulse
4. Создает и отправляет архив с логами для детального анализа

## Настройка

Скрипт уже настроен с вашими токенами и идентификаторами:
- Токен бота: NeuroBlogger (6950844437:AAFnSoX01iXljaNxmsPojm7Cw5CJqw1O3qY)
- ID администратора: 144022504 (ваш личный чат с ботом)
- Канал пульс: @neuro_blogger_pulse

## Расписание запуска

Скрипт запускается автоматически по следующему расписанию:
- Каждый час (через crontab)
- При перезапуске контейнеров (через mоnitor-containers.sh)
- При обнаружении критических ошибок (через mоnitor-errors.sh)

## Что отправляется в уведомлениях

### Личные уведомления администратору (ID: 144022504):
- Полный отчет о состоянии сервера
- Примеры обнаруженных ошибок
- Информация о системных ресурсах (диск, память, CPU)
- Архив с логами для детального анализа

### Уведомления в канал @neuro_blogger_pulse (только при серьезных проблемах):
- Краткое сообщение о проблеме
- Количество обнаруженных ошибок
- Информация о перезапусках контейнеров (если были)

## Ручной запуск

Для ручного запуска проверки и отправки уведомлений:
```bash
ssh -i ~/.ssh/id_rsa root@999-multibots-u14194.vm.elestio.app
cd /root
./admin-pulse-notify.sh
```

## Просмотр журнала уведомлений

Журнал всех отправленных уведомлений хранится в файле:
```
/root/logs/admin_notifications.log
```

Для просмотра:
```bash
ssh -i ~/.ssh/id_rsa root@999-multibots-u14194.vm.elestio.app "cat /root/logs/admin_notifications.log"
```

## Изменение настроек

Если необходимо изменить настройки (токены, ID, частоту проверок):

1. Отредактируйте скрипт:
   ```bash
   ssh -i ~/.ssh/id_rsa root@999-multibots-u14194.vm.elestio.app
   nano /root/admin-pulse-notify.sh
   ```

2. Для изменения расписания запуска отредактируйте crontab:
   ```bash
   ssh -i ~/.ssh/id_rsa root@999-multibots-u14194.vm.elestio.app
   crontab -e
   ```

## Условия отправки уведомлений

1. **Личные уведомления** отправляются при обнаружении любых ошибок в логах.

2. **Уведомления в канал пульса** отправляются только при:
   - Обнаружении более 10 ошибок
   - Перезапуске контейнеров
   
Эти пороги можно изменить в скрипте (строка 104). 