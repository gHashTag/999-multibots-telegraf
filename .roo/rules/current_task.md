---
description: 
globs: 
alwaysApply: true
---
# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ü–æ—Ç–æ–∫–∞ –ü–æ–¥–ø–∏—Å–∫–∏, –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ë–∞–ª–∞–Ω—Å–∞ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û—à–∏–±–æ–∫

## ‚ö†Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç:
*   –í–µ—Ç–∫–∞ `main` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.
*   –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø–ª–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏ –≤ `paymentOptionsPlans`.
*   –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `subscriptionScene`.
*   –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤—Ö–æ–¥–∞ –≤ `starPaymentScene`.
*   –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ `Amount not found` –≤ `handleBuySubscription`.
*   –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –≤ `handleSuccessfulPayment` (–ø–∞—Ä—Å–∏–Ω–≥ payload, –≤—Ö–æ–¥ –≤ –º–µ–Ω—é).
*   –£–¥–∞–ª–µ–Ω–∞ –ª–∏—à–Ω—è—è –ø—Ä–æ–≤–µ—Ä–∫–∞ `successful_payment` –∏–∑ `starPaymentScene`.
*   –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ `pre_checkout_query` –∏ `successful_payment` –≤ `src/bot.ts`.
*   –£–¥–∞–ª–µ–Ω –¥—É–±–ª–∏—Ä—É—é—â–∏–π—Å—è –∏ –Ω–µ—Ä–∞–±–æ—á–∏–π –≤—ã–∑–æ–≤ `sendNotification` –∏–∑ `handleSuccessfulPayment`.
*   –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—à–∏–±–∫–∏ –ª–∏–Ω—Ç–µ—Ä–∞.
*   ‚úÖ **–†–∞–∑—Ä–µ—à–µ–Ω—ã –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å–ª–∏—è–Ω–∏—è –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤** –ø–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è stash –¥–ª—è `digitalAvatarBody` (–≤ —Ñ–∞–π–ª–∞—Ö `index.ts`, `inngest/generateModelTraining.ts` –∏ `inngest/__tests__/generateModelTraining.test.ts`). –§–∞–π–ª `src/bot.ts` –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ `main`.
*   ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/generateModelTraining.ts`** –ø–æ –≤—ã–Ω–µ—Å–µ–Ω–∏—é –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–π –ª–æ–≥–∏–∫–∏ –≤ —Ö–µ–ª–ø–µ—Ä—ã (–≤–∫–ª—é—á–∞—è `startFluxLoraTrainerReplicateTraining`).
*   ‚úÖ **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –æ—Å–Ω–æ–≤–Ω—ã–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤** –≤ `src/modules/digitalAvatarBody/generateModelTraining.ts` –∏ `src/modules/digitalAvatarBody/helpers/modelTrainingsDb.ts`.
*   ‚úÖ **–°—Ç–∞—Ç—É—Å—ã –æ–ø–µ—Ä–∞—Ü–∏–π –≤ `generateModelTraining.ts` –∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Ö–µ–ª–ø–µ—Ä–∞—Ö (`trainingHelpers.ts`) –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –∫ –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–∏—é (UPPERCASE): `PENDING`, `PROCESSING`, `SUCCEEDED`, `FAILED`.**
*   ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è —Ö–µ–ª–ø–µ—Ä–æ–≤:** `trainingHelpers.ts` –∏ `modelTrainingsDb.ts`.
*   ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω—ã unit-—Ç–µ—Å—Ç—ã –¥–ª—è `src/modules/digitalAvatarBody/generateModelTraining.ts` (–ü–ª–∞–Ω –ë, –Ω–µ Inngest).**
*   ‚úÖ **–ó–∞–≤–µ—Ä—à–µ–Ω–∞ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Ö–µ–ª–ø–µ—Ä–æ–≤ –≤ Inngest-—Ñ—É–Ω–∫—Ü–∏—é `src/modules/digitalAvatarBody/functions/generateModelTraining.ts`** (–≤–∫–ª—é—á–∞—è `ensureReplicateModelExists`).
*   ‚úÖ **–£–¥–∞–ª–µ–Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∞—è Inngest-—Ñ—É–Ω–∫—Ü–∏—è** (`generateDigitalAvatarModelTraining` —Å id `generate-digital-avatar-model-training`) –∏–∑ `src/modules/digitalAvatarBody/functions/generateModelTraining.ts`.
*   ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤** –≤ `src/modules/digitalAvatarBody/functions/generateModelTraining.ts` –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞, —É–¥–∞–ª–µ–Ω–∏—è —Å—Ç–∞—Ä–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤.
*   ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è `digitalAvatarBody` –∑–∞–≤–µ—Ä—à–µ–Ω**: –ú–æ–¥—É–ª—å —Å–¥–µ–ª–∞–Ω —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –ø–æ –æ—Å–Ω–æ–≤–Ω—ã–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–º –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞–º, —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –ø—Ä—è–º—ã–µ –∏–º–ø–æ—Ä—Ç—ã –∏–∑ `src/config` (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º `INNGEST_EVENT_KEY`, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–ª–µ–Ω –∫–∞–∫ –≥–ª–æ–±–∞–ª—å–Ω—ã–π).
*   ‚úÖ **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π `digitalAvatarBody` (–§–∞–∑–∞ 1):**
    *   ‚úÖ –ó–∞–º–µ–Ω–µ–Ω –∏–º–ø–æ—Ä—Ç –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ª–æ–≥–≥–µ—Ä–∞ –Ω–∞ –º–æ–¥—É–ª—å–Ω—ã–π –≤ `src/modules/digitalAvatarBody/helpers/modelTrainingsDb.ts` –∏ –¥—Ä—É–≥–∏—Ö —Ñ–∞–π–ª–∞—Ö –º–æ–¥—É–ª—è.
    *   ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/generateModelTraining.ts` (–ü–ª–∞–Ω –ë):
        *   ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `createModelTraining` –Ω–∞ –º–æ–¥—É–ª—å–Ω—ã–π `createDigitalAvatarTraining`.
        *   ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã (–≤ `userProfileDb.ts`) –¥–ª—è –∑–∞–º–µ–Ω—ã `getUserByTelegramIdString` –∏ `updateUserLevelPlusOne`.
        *   ‚úÖ –ó–∞–º–µ–Ω–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `processBalanceOperation` –Ω–∞ –º–æ–¥—É–ª—å-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π `validateAndPrepareTrainingRequest`.
    *   ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/helpers/trainingHelpers.ts`:
        *   ‚úÖ –°–æ–∑–¥–∞–Ω—ã –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –º–æ–¥—É–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã (–≤ `userProfileDb.ts`) –¥–ª—è –∑–∞–º–µ–Ω—ã `getUserByTelegramId` (–≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ) –∏ `updateUserBalance`.
        *   ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ `updateUserNeuroTokens` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–π —Å—É–º–º—ã –∏ `botName`.
    *   ‚úÖ –ü–µ—Ä–µ–Ω–µ—Å–µ–Ω `INNGEST_EVENT_KEY` –∏–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ñ–∏–≥–∞ (`@/config/index`) –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –º–æ–¥—É–ª—è `digitalAvatarBody` (`./config`).
*   ‚úÖ **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã Unit-—Ç–µ—Å—Ç—ã –¥–ª—è `src/modules/digitalAvatarBody/helpers/trainingHelpers.ts`** (`validateAndPrepareTrainingRequest` –ø—Ä–æ—Ö–æ–¥–∏—Ç).
*   ‚úÖ **–ê—É–¥–∏—Ç –∏ —á–∏—Å—Ç–∫–∞ `src/modules/digitalAvatarBody/index.ts`** - –∑–∞–≤–µ—Ä—à–µ–Ω (—É–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∏–º–ø–æ—Ä—Ç, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ updateUserNeuroTokens –≤ trainingHelpers.ts –∏ —Ç–µ—Å—Ç–∞—Ö).
*   ‚úÖ **–ê—É–¥–∏—Ç –∏ —á–∏—Å—Ç–∫–∞ `src/scenes/uploadTrainFluxModelScene/index.ts`**: –ü—Ä–æ–≤–µ—Ä–µ–Ω –Ω–∞ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥, –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Ç–∏–ø–∞ `gender`, –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `payment_operation_type`.
*   ‚úÖ **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏, –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ, —Å–¥–µ–ª–∞—Ç—å —Ç–∏–ø `ModelTraining` –≤ `modelTrainingsDb.ts` —Å–∞–º–æ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º**, —É—Å—Ç—Ä–∞–Ω–∏–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç `CoreModelTraining` –∏–∑ `@/core/supabase/createModelTraining`.
*   ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ Inngest-—Ñ—É–Ω–∫—Ü–∏–∏ `handleReplicateWebhookDigitalAvatarBody`** –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Ö–µ–ª–ø–µ—Ä–∞ `getDigitalAvatarTrainingByReplicateIdWithUserDetails` –∏–∑ `modelTrainingsDb.ts`.
*   ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –≤ `src/modules/digitalAvatarBody/__tests__/generateModelTraining.test.ts`** –ø–æ—Å–ª–µ –º–Ω–æ–≥–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö –∏—Ç–µ—Ä–∞—Ü–∏–π –ø–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é –º–æ–∫–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Ç–∏–ø–æ–≤.
*   ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ `Multipart: Boundary not found`** –≤ `ai-server` –ø—É—Ç–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π –ø–µ—Ä–µ–¥–∞—á–∏ `gender` –∏–∑ `trainFluxModelWizard` –≤ `uploadTrainFluxModelScene` –∏ –¥–∞–ª–µ–µ –≤ `createModelTraining`.
*   ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ `ENOENT` –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ ZIP-—Ñ–∞–π–ª–∞** –≤ `uploadTrainFluxModelScene` –ø—É—Ç–µ–º —É–¥–∞–ª–µ–Ω–∏—è –¥—É–±–ª–∏—Ä—É—é—â–µ–≥–æ –≤—ã–∑–æ–≤–∞ `deleteFile`.
*   ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º URL ZIP-—Ñ–∞–π–ª–∞** –≤ `uploadTrainFluxModelScene` (—É–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL).

**–°–ª–µ–¥—É—é—â–∏–µ –®–∞–≥–∏ (–ú–æ–¥—É–ª—å `digitalAvatarBody`):**

*   ‚úèÔ∏è **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì):
    *   üóëÔ∏è ~~–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `getBotByName` –≤ `src/modules/digitalAvatarBody/utils/telegramNotifier.ts`.~~ (–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getBotByName` –≤ –º–æ–¥—É–ª–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
    *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ `inngest` –≤ `src/modules/digitalAvatarBody/utils/inngestPublisher.ts`.
    *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ `supabase` –≤ `src/modules/digitalAvatarBody/helpers/modelTrainingsDb.ts` –∏ `src/modules/digitalAvatarBody/helpers/userProfileDb.ts`.
*   ‚úèÔ∏è **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–µ–ª–ø–µ—Ä–æ–≤ –∏ —É—Ç–∏–ª–∏—Ç**:
    *   –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –ø–æ–ª–Ω–æ—Ç–µ unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ `src/modules/digitalAvatarBody/helpers/` –∏ `src/modules/digitalAvatarBody/utils/` –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
*   ‚úèÔ∏è **–û–±—â–µ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: –û—Ü–µ–Ω–∏—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è Inngest-—Ñ—É–Ω–∫—Ü–∏–∏ (`functions/generateModelTraining.ts`) –∏ "–ü–ª–∞–Ω–∞ –ë" (`generateModelTraining.ts`) –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.
*   ‚úèÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `calculator.test.ts`, —Ç–µ—Å—Ç—ã Supabase, –µ—Å–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ).
*   ‚úèÔ∏è –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã `notifyBotOwners` –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è.

## üõë –ù–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã:
*   –ü—Ä–æ–±–ª–µ–º—ã —Å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π `notifyBotOwners` (–Ω—É–∂–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Å–ª–µ –¥–µ–ø–ª–æ—è).
*   –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`calculator.test.ts`, —Ç–µ—Å—Ç—ã Supabase).
*   –û—Å—Ç–∞–≤—à–∏–µ—Å—è –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –∏–ª–∏ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –∫–æ–¥ –≤ `src/scenes/uploadTrainFluxModelScene/index.ts` (–±—É–¥—É—Ç —Ä–∞—Å—Å–º–æ—Ç—Ä–µ–Ω—ã).
*   –í–æ–ø—Ä–æ—Å –æ —Ç–∏–ø–µ `ModelTraining` –≤ `modelTrainingsDb.ts` –∏ –µ–≥–æ –≤–æ–∑–º–æ–∂–Ω–æ–π –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç `CoreModelTraining`.

# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ú–æ–¥—É–ª—è `digitalAvatarBody`

**–¶–µ–ª—å:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –æ—á–∏—Å—Ç–∏—Ç—å –º–æ–¥—É–ª—å `digitalAvatarBody` –æ—Ç –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π —Ç–∞–º, –≥–¥–µ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ, –æ–±–µ—Å–ø–µ—á–∏—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å, –ø–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏ –∫–ª—é—á–µ–≤—É—é –ª–æ–≥–∏–∫—É –∏ —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –∏ –ª–∏–Ω—Ç–µ—Ä–∞. –ü—Ä–∏–¥–µ—Ä–∂–∏–≤–∞—Ç—å—Å—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∏–ª—è.

**–ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π:**

1.  ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/generateModelTraining.ts`** (–ü–ª–∞–Ω –ë, –Ω–µ Inngest) - –∑–∞–≤–µ—Ä—à–µ–Ω.
2.  ‚úÖ –ù–∞–ø–∏—Å–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –¥–ª—è –≤—ã–Ω–µ—Å–µ–Ω–Ω—ã—Ö —Ö–µ–ª–ø–µ—Ä–æ–≤ (`trainingHelpers.ts`, `modelTrainingsDb.ts`).
3.  ‚úÖ **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ —Ç–∏–ø–æ–≤ –≤ `src/modules/digitalAvatarBody/__tests__/generateModelTraining.test.ts`**.
4.  ‚úÖ **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ç—å `src/modules/digitalAvatarBody/functions/generateModelTraining.ts` (Inngest-—Ñ—É–Ω–∫—Ü–∏—è):**
    *   ‚úÖ –õ–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `sendTelegramMessageFromWorker`.
    *   ‚úÖ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `inngest` –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–æ (–∏–Ω—ä–µ–∫—Ü–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ - —ç—Ç–æ —Ö–æ—Ä–æ—à–æ).
5.  ‚úÖ **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/index.ts` –∑–∞–≤–µ—Ä—à–µ–Ω**: –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `sendTelegramMessageFromWorker` –∏ `inngest.send` –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω—ã —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã `sendModuleTelegramMessage` –∏ `publishDigitalAvatarTrainingEvent`.
6.  ‚úÖ **–ü—Ä–æ–±–ª–µ–º–∞ —Å –∫–æ–º–º–∏—Ç–æ–º —Ä–µ—à–µ–Ω–∞**: –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã —Å —Ñ–ª–∞–≥–æ–º `--no-verify` –∏–∑-–∑–∞ –≤–Ω–µ—à–Ω–µ–π –ø—Ä–æ–±–ª–µ–º—ã —Å husky/corepack.
7.  ‚úÖ **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –õ–æ–≥–∏–∫–∏ –ó–∞–ø—É—Å–∫–∞ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ Replicate –∑–∞–≤–µ—Ä—à–µ–Ω–∞:**
    *   –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/modules/digitalAvatarBody/helpers/trainingHelpers.ts` –≤—ã–ø–æ–ª–Ω–µ–Ω.
    *   `startReplicateTraining` —Å—Ç–∞–ª–∞ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π —Ç–æ—á–∫–æ–π –≤—Ö–æ–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–æ–∫ Replicate.
    *   –õ–æ–≥–∏–∫–∞ –∏–∑ `startFluxLoraTrainerReplicateTraining` –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞, —Å—Ç–∞—Ä–∞—è —Ñ—É–Ω–∫—Ü–∏—è —É–¥–∞–ª–µ–Ω–∞.
    *   `startReplicateTraining` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥—É–ª—è –∏ `DigitalAvatarUserProfile`.
8.  ‚úÖ **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –õ–æ–≥–∏–∫–∏ –û–±—Ä–∞–±–æ—Ç–∫–∏ –û—à–∏–±–æ–∫ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –≤ –ë–î –∑–∞–≤–µ—Ä—à–µ–Ω–∞:**
    *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Ñ—É–Ω–∫—Ü–∏–∏ `updateTrainingRecordOnError` –∏ `setDigitalAvatarTrainingError`.
    *   `updateTrainingRecordOnError` (–≤ `trainingHelpers.ts`) —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `trainingId` –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `setDigitalAvatarTrainingError` (–∏–∑ `modelTrainingsDb.ts`).
    *   –í—ã–∑–æ–≤—ã –≤ `generateModelTraining.ts` (–ü–ª–∞–Ω –ë) –æ–±–Ω–æ–≤–ª–µ–Ω—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `trainingId`.
9.  ‚úÖ **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –æ—à–∏–±–∫–∞ —Å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–º URL ZIP-—Ñ–∞–π–ª–∞** –≤ `uploadTrainFluxModelScene` (—É–¥–∞–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ URL).
10. ‚úèÔ∏è **–ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è –≤–Ω–µ—à–Ω–∏—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π** (–°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì):
    *   üóëÔ∏è ~~–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ `getBotByName` –≤ `src/modules/digitalAvatarBody/utils/telegramNotifier.ts`.~~ (–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `getBotByName` –≤ –º–æ–¥—É–ª–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ)
    *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ `inngest` –≤ `src/modules/digitalAvatarBody/utils/inngestPublisher.ts`.
    *   –ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏ –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ `supabase` –≤ `src/modules/digitalAvatarBody/helpers/modelTrainingsDb.ts` –∏ `src/modules/digitalAvatarBody/helpers/userProfileDb.ts`.
11. ‚úèÔ∏è **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–µ–ª–ø–µ—Ä–æ–≤ –∏ —É—Ç–∏–ª–∏—Ç**:
    *   –£–±–µ–¥–∏—Ç—å—Å—è –≤ –Ω–∞–ª–∏—á–∏–∏ –∏ –ø–æ–ª–Ω–æ—Ç–µ unit-—Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ `src/modules/digitalAvatarBody/helpers/` –∏ `src/modules/digitalAvatarBody/utils/` –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.
12. ‚úèÔ∏è **–û–±—â–µ–µ —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ**: –û—Ü–µ–Ω–∏—Ç—å –∏ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Ä–∞—Å—à–∏—Ä–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ –¥–ª—è Inngest-—Ñ—É–Ω–∫—Ü–∏–∏ (`functions/generateModelTraining.ts`) –∏ "–ü–ª–∞–Ω–∞ –ë" (`generateModelTraining.ts`) –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ª–æ–∫–∞–ª–∏–∑–∞—Ü–∏–∏.
13. ‚úèÔ∏è –ù–∞–ø–∏—Å–∞–Ω–∏–µ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥—É–ª–µ–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `calculator.test.ts`, —Ç–µ—Å—Ç—ã Supabase, –µ—Å–ª–∏ –∞–∫—Ç—É–∞–ª—å–Ω–æ).

# üïâÔ∏è –¢–µ–∫—É—â–∞—è –ó–∞–¥–∞—á–∞: –†–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∏ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –û—à–∏–±–∫–∏ 500 –æ—Ç ai-server –ø—Ä–∏ –¢—Ä–µ–Ω–∏—Ä–æ–≤–∫–µ –ú–æ–¥–µ–ª–∏

## ‚ö†Ô∏è –ö–æ–Ω—Ç–µ–∫—Å—Ç:
*   –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –∑–∞–ø—É—Å–∫–∞ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `uploadTrainFluxModelScene` (–∫–æ—Ç–æ—Ä–∞—è –≤—ã–∑—ã–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å `createModelTraining`) `ai-server` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫—É 500 (Internal Server Error).
*   URL –∑–∞–ø—Ä–æ—Å–∞ –∫ `ai-server`: `https://ai-server-u14194.vm.elestio.app/generate/create-model-training`.
*   –ö–æ–¥ –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ –±–æ—Ç–∞ (`src/services/createModelTraining.ts`) —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `FormData` –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –≤–∫–ª—é—á–∞—è –ø–æ–ª–µ `gender`, –∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–æ–∫ —Ç–∏–ø–æ–≤.
*   –§–∞–π–ª—ã –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ –º–æ–¥—É–ª—è `digitalAvatarBody` (`src/modules/digitalAvatarBody/*`) –±—ã–ª–∏ —É–¥–∞–ª–µ–Ω—ã. –¢–µ–∫—É—â–∏–π –ø–æ—Ç–æ–∫ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å.

## üéØ –¶–µ–ª—å:
–£—Å—Ç—Ä–∞–Ω–∏—Ç—å –æ—à–∏–±–∫—É 500, —á—Ç–æ–±—ã —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∞ –º–æ–¥–µ–ª–µ–π —Å–Ω–æ–≤–∞ —Ä–∞–±–æ—Ç–∞–ª–∞.

## üõ†Ô∏è –ü–ª–∞–Ω –î–µ–π—Å—Ç–≤–∏–π:

1.  ‚úèÔ∏è **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ª–æ–≥–∏ `ai-server`** (–°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì, –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ì—É—Ä—É):
    *   –ù–∞–π—Ç–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—à–∏–±–∫–µ, –≤–æ–∑–Ω–∏–∫–∞—é—â–µ–π –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞ `POST /generate/create-model-training`.
    *   –û—Å–æ–±–æ–µ –≤–Ω–∏–º–∞–Ω–∏–µ —É–¥–µ–ª–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫–µ `multipart/form-data`, –ø–æ–ª—è `gender`, –∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –ø–æ—Ç–æ–∫–∞ `zipUrl`.
2.  ‚úèÔ∏è **–ò—Å–ø—Ä–∞–≤–∏—Ç—å –æ—à–∏–±–∫—É –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ `ai-server`** (–≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ì—É—Ä—É –∏–ª–∏ —Å–æ–≤–º–µ—Å—Ç–Ω–æ):
    *   –ù–∞ –æ—Å–Ω–æ–≤–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –≤–Ω–µ—Å—Ç–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ–¥ `ai-server`.
3.  ‚úèÔ∏è **–ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏** –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è `ai-server`, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è –≤ —É—Å–ø–µ—Ö–µ.
4.  ‚úèÔ∏è **–û–±–Ω–æ–≤–∏—Ç—å `SUCCESS_HISTORY.md` –∏–ª–∏ `REGRESSION_PATTERNS.md`** –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º.

## üõë –ù–µ—Ä–µ—à–µ–Ω–Ω—ã–µ –ü—Ä–æ–±–ª–µ–º—ã:
*   –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞ —Ç–æ—á–Ω–∞—è –ø—Ä–∏—á–∏–Ω–∞ –æ—à–∏–±–∫–∏ 500 –Ω–∞ `ai-server`.