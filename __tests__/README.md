# –¢–µ—Å—Ç–æ–≤—ã–π –ú–æ–¥—É–ª—å: –ü—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç –∏ –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¶–µ–Ω ‚≠ê

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –ø—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç —Ü–µ–Ω, —Ä–∞—Å—Å—á–∏—Ç–∞–Ω–Ω—ã–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º `calculateFinalStarPrice`, –∏ —Å—Ç–∞—Ç—É—Å –ø–æ–∫—Ä—ã—Ç–∏—è —Ç–µ—Å—Ç–∞–º–∏ –¥–ª—è –º–æ–¥—É–ª—è —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è.

## üí∞ –ü—Ä–µ–π—Å–∫—É—Ä–∞–Ω—Ç (–°—Ç–æ–∏–º–æ—Å—Ç—å –≤ –∑–≤–µ–∑–¥–∞—Ö ‚≠ê)

–¶–µ–Ω—ã —Ä–∞—Å—Å—á–∏—Ç–∞–Ω—ã —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–∏—Ö –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (`STAR_COST_USD=0.016`, `MARKUP_MULTIPLIER=1.5`) –∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è.

| –†–µ–∂–∏–º (ModeEnum)                      | –ü—Ä–∏–º–µ—Ä –ü–∞—Ä–∞–º–µ—Ç—Ä–æ–≤        | –°—Ç–æ–∏–º–æ—Å—Ç—å ‚≠ê |
| :------------------------------------ | :----------------------- | :----------- |
| `ModeEnum.NeuroPhoto`                 | `numImages: 1`           | 9            |
| `ModeEnum.NeuroPhoto`                 | `numImages: 3`           | 28           |
| `ModeEnum.NeuroPhotoV2`               | `numImages: 1`           | 14           |
| `ModeEnum.VoiceToText`                | -                        | 4            |
| `ModeEnum.TextToSpeech`               | -                        | 1            |
| `ModeEnum.LipSync`                    | -                        | 2            |
| `ModeEnum.DigitalAvatarBody`          | `steps: 10`              | 93           |
| `ModeEnum.DigitalAvatarBodyV2`        | `steps: 10`              | 187          |
| `ModeEnum.TextToVideo`                | `modelId: 'ray-v2'`      | 16           |
| `ModeEnum.TextToVideo`                | `modelId: 'minimax'`     | 46           |
| `ModeEnum.ImageToVideo`               | `modelId: 'ray-v2'`      | 16           |
| `ModeEnum.ImageToVideo`               | `modelId: 'minimax'`     | 46           |
| `ModeEnum.TextToImage`                | `modelId: 'flux-pro'`    | 5            |
| `ModeEnum.TextToImage`                | `modelId: 'no-exist'`    | 0            |
| `ModeEnum.MainMenu`                   | -                        | 0            |
| `ModeEnum.ImageToPrompt`              | -                        | 0            |
| `ModeEnum.Subscribe`                  | -                        | 0            |
| `ModeEnum.Avatar`                     | -                        | 0            |
| `ModeEnum.ChatWithAvatar`             | -                        | 0            |
| `ModeEnum.SelectModel`                | -                        | 0            |
| `ModeEnum.SelectAiTextModel`          | -                        | 0            |
| `ModeEnum.SelectModelWizard`          | -                        | 0            |
| `ModeEnum.Voice`                      | -                        | 0            |
| `ModeEnum.SelectNeuroPhoto`           | -                        | 0            |
| `ModeEnum.ChangeSize`                 | -                        | 0            |
| `ModeEnum.Invite`                     | -                        | 0            |
| `ModeEnum.Help`                       | -                        | 0            |
| `ModeEnum.Balance`                    | -                        | 0            |
| `ModeEnum.ImprovePrompt`              | -                        | 0            |
| `ModeEnum.TopUpBalance`               | -                        | 0            |
| `ModeEnum.VideoInUrl`                 | -                        | 0            |
| `ModeEnum.Support`                    | -                        | 0            |
| `ModeEnum.Stats`                      | -                        | 0            |
| `ModeEnum.BroadcastWizard`            | -                        | 0            |
| `ModeEnum.SubscriptionCheckScene`     | -                        | 0            |
| `ModeEnum.ImprovePromptWizard`        | -                        | 0            |
| `ModeEnum.SizeWizard`                 | -                        | 0            |
| `ModeEnum.PaymentScene`               | -                        | 0            |
| `ModeEnum.InviteScene`                | -                        | 0            |
| `ModeEnum.BalanceScene`               | -                        | 0            |
| `ModeEnum.Step0`                      | -                        | 0            |
| `ModeEnum.NeuroCoderScene`            | -                        | 0            |
| `ModeEnum.CheckBalanceScene`          | -                        | 0            |
| `ModeEnum.CancelPredictionsWizard`    | -                        | 0            |
| `ModeEnum.EmailWizard`                | -                        | 0            |
| `ModeEnum.GetRuBillWizard`            | -                        | 0            |
| `ModeEnum.SubscriptionScene`          | -                        | 0            |
| `ModeEnum.CreateUserScene`            | -                        | 0            |
| `ModeEnum.StartScene`                 | -                        | 0            |
| `ModeEnum.Price`                      | -                        | 0            |
| `ModeEnum.RublePaymentScene`          | -                        | 0            |
| `ModeEnum.StarPaymentScene`           | -                        | 0            |
| `ModeEnum.MenuScene`                  | -                        | 0            |

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è —Ä–µ–∂–∏–º–æ–≤, –∑–∞–≤–∏—Å—è—â–∏—Ö –æ—Ç –º–æ–¥–µ–ª–∏ –∏–ª–∏ —à–∞–≥–æ–≤, –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –ø—Ä–∏–º–µ—Ä—ã —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏. –°—Ç–æ–∏–º–æ—Å—Ç—å –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–æ–¥–µ–ª–µ–π/–∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —à–∞–≥–æ–≤ –±—É–¥–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.* 
*–†–µ–∂–∏–º—ã, –Ω–µ —É–∫–∞–∑–∞–Ω–Ω—ã–µ —è–≤–Ω–æ –∫–∞–∫ –ø–ª–∞—Ç–Ω—ã–µ, —Å—á–∏—Ç–∞—é—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω—ã–º–∏ (0 ‚≠ê).*

## üìä –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

*   **`src/price/calculator.ts`:**
    *   **–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–∫—Ä—ã—Ç —é–Ω–∏—Ç-—Ç–µ—Å—Ç–∞–º–∏ (`src/__tests__/price/calculator.test.ts`).
    *   **–ü–æ–∫—Ä—ã—Ç—ã–µ –∞—Å–ø–µ–∫—Ç—ã:**
        *   –†–∞—Å—á–µ—Ç –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ü–µ–Ω.
        *   –†–∞—Å—á–µ—Ç –¥–ª—è —Ü–µ–Ω –ø–æ —à–∞–≥–∞–º (`steps`).
        *   –†–∞—Å—á–µ—Ç –¥–ª—è —Ü–µ–Ω –ø–æ –º–æ–¥–µ–ª—è–º (`modelId` –¥–ª—è –≤–∏–¥–µ–æ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
        *   –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `numImages`.
        *   –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω—ã—Ö/–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤.
        *   –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö `modelId` / `steps`.
    *   **–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã:** 1 —Ç–µ—Å—Ç –Ω–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏–µ (`vi.doMock` –Ω–µ—Å—Ç–∞–±–∏–ª–µ–Ω).
*   **`src/scenes/checkBalanceScene.ts`:**
    *   **–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã (`src/__tests__/scenes/checkBalanceScene.integration.test.ts`) –≤—Ä–µ–º–µ–Ω–Ω–æ **–Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è** –∏–∑-–∑–∞ –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ `BOT_TOKEN_1` –ø—Ä–∏ –∏–º–ø–æ—Ä—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.
    *   **–¢—Ä–µ–±—É–µ—Ç—Å—è:** –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ `src/core/bot/index.ts` –¥–ª—è –æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Telegraf –∏–ª–∏ –∏–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å `.env` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –≤ —Ç–µ—Å—Ç–∞—Ö.
*   **–°–ø–∏—Å–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤ (`updateUserBalance`):**
    *   **–°—Ç–∞—Ç—É—Å:** ‚úÖ –õ–æ–≥–∏–∫–∞ –≤—ã–∑–æ–≤–∞ `updateUserBalance` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ (–æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å, —Ç–∏–ø `MONEY_OUTCOME`) –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –≤ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö (–∫–æ–≥–¥–∞ –æ–Ω–∏ —Ä–∞–±–æ—Ç–∞–ª–∏).
*   **–í–æ–∑–≤—Ä–∞—Ç—ã (Refund):**
    *   **–°—Ç–∞—Ç—É—Å:** ‚ùì –ù–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–æ. –¢–µ–∫—É—â–∏–µ —Ç–µ—Å—Ç—ã –Ω–µ –ø–æ–∫—Ä—ã–≤–∞—é—Ç –ª–æ–≥–∏–∫—É –≤–æ–∑–≤—Ä–∞—Ç–æ–≤. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ —Ç–∞–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏. 

## üî¨ –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –∏ –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ (–û—Ü–µ–Ω–∫–∞)

–≠—Ç–∞ —Ç–∞–±–ª–∏—Ü–∞ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –ø—Ä–∏–º–µ—Ä–Ω—É—é —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–π, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏—Ö Replicate, —Å –Ω–∞—à–µ–π —Ç–µ–∫—É—â–µ–π —Ü–µ–Ω–æ–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –†–∞—Å—á–µ—Ç–∞:**
*   `STAR_COST_USD` (–°—Ç–æ–∏–º–æ—Å—Ç—å 1 ‚≠ê –¥–ª—è –Ω–∞—Å): $0.016
*   –¶–µ–Ω—ã Replicate –≤–∑—è—Ç—ã —Å [https://replicate.com/pricing](https://replicate.com/pricing) (–º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è).
*   –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–æ–¥–µ–ª–µ–π –Ω–∞ Replicate - —ç—Ç–æ **–æ—Ü–µ–Ω–∫–∞**, —Ä–µ–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.
*   –ù–∞—à–∞ –¶–µ–Ω–∞ (USD) = –ù–∞—à–∞ –¶–µ–Ω–∞ (‚≠ê) * `STAR_COST_USD`
*   –ú–∞—Ä–∂–∞ (USD) = –ù–∞—à–∞ –¶–µ–Ω–∞ (USD) - –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (USD)
*   –ú–∞—Ä–∂–∞ (%) = (–ú–∞—Ä–∂–∞ (USD) / –ù–∞—à–∞ –¶–µ–Ω–∞ (USD)) * 100

| –£—Å–ª—É–≥–∞ (–†–µ–∂–∏–º)         | –ú–æ–¥–µ–ª—å Replicate (–ü—Ä–∏–º–µ—Ä)        | –û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ (Replicate) | –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å (USD, –ø—Ä–∏–±–ª.) | –ù–∞—à–∞ –¶–µ–Ω–∞ (‚≠ê) | –ù–∞—à–∞ –¶–µ–Ω–∞ (USD) | –ú–∞—Ä–∂–∞ (USD, –ø—Ä–∏–±–ª.) | –ú–∞—Ä–∂–∞ (%, –ø—Ä–∏–±–ª.) |
| :--------------------- | :------------------------------- | :----------------------- | :-------------------------- | :------------- | :--------------- | :------------------- | :----------------- |
| `TextToImage`          | `flux-1.1-pro`                   | L40S (?)                 | $0.0039 (4s @ $0.000975/s)  | 5              | $0.080           | $0.076              | 95.1%              |
| `TextToVideo`          | `ray-v2` (Luma)                  | A100 (80GB) (?)          | $0.021 (15s @ $0.001400/s) | 16             | $0.256           | $0.235              | 91.8%              |
| `TextToVideo`          | `minimax`                        | A100 (80GB) (?)          | $0.021 (15s @ $0.001400/s) | 46             | $0.736           | $0.715              | 97.1%              |
| `DigitalAvatarBodyV2`  | *Custom Cog Model?*              | T4 (?)                   | $0.0225 (100s @ $0.000225/s)| 187            | $2.992           | $2.969              | 99.2%              |
| `VoiceToText`          | *Whisper/AssemblyAI?*            | CPU / T4 (?)             | $0.001 (10s @ $0.000100/s)  | 4              | $0.064           | $0.063              | 98.4%              |
| `TextToSpeech`         | *ElevenLabs/OpenAI TTS?*         | CPU (?)                  | $0.0001 (1s @ $0.000100/s)   | 1              | $0.016           | $0.016              | ~100%              |
| `LipSync`              | *Wav2Lip/SadTalker?*             | T4 (?)                   | $0.0045 (20s @ $0.000225/s)  | 2              | $0.032           | $0.028              | 87.5%              |

**–í–∞–∂–Ω—ã–µ –ó–∞–º–µ—á–∞–Ω–∏—è:**
*   –¢–∏–ø –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è Replicate –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–æ–¥–µ–ª–µ–π - —ç—Ç–æ **–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ**. –†–µ–∞–ª—å–Ω—ã–µ –∑–∞—Ç—Ä–∞—Ç—ã –º–æ–≥—É—Ç –æ—Ç–ª–∏—á–∞—Ç—å—Å—è.
*   –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–∑—è—Ç–æ **–ø—Ä–∏–±–ª–∏–∑–∏—Ç–µ–ª—å–Ω–æ**. –°–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—Ä–æ—Å–∞ —Å–∏–ª—å–Ω–æ –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Ä–µ–º—è –∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ, –Ω–∞ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å.
*   –î–ª—è `VoiceToText`, `TextToSpeech`, `LipSync` –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è *–¥—Ä—É–≥–∏–µ* API (–Ω–µ Replicate –Ω–∞–ø—Ä—è–º—É—é), –∏—Ö —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å –æ—Ü–µ–Ω–µ–Ω–∞ –æ—á–µ–Ω—å –≥—Ä—É–±–æ.
*   –í—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç –º–∞—Ä–∂–∏ –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —Ç–æ, —á—Ç–æ `STAR_COST_USD` ($0.016) —É–∂–µ –≤–∫–ª—é—á–∞–µ—Ç –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—É—é –Ω–∞—Ü–µ–Ω–∫—É —Å–≤–µ—Ä—Ö –ø—Ä—è–º—ã—Ö –∑–∞—Ç—Ä–∞—Ç –Ω–∞ API, –ª–∏–±–æ –Ω–∞—à–∏ –æ—Ü–µ–Ω–∫–∏ —Å–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∑–∞–Ω–∏–∂–µ–Ω—ã. 