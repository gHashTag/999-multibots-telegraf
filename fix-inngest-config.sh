#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ Inngest –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ
# –£–¥–∞–ª—è–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

echo "üîß –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ Inngest..."
grep "INNGEST_DEV\|INNGEST_BASE" .env

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ Inngest..."

# –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
temp_file=".env.tmp"

# –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª .env
while IFS= read -r line
do
  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å INNGEST_DEV
  if [[ $line == *"INNGEST_DEV"* ]]; then
    echo "üóëÔ∏è –£–¥–∞–ª—è–µ–º —Å—Ç—Ä–æ–∫—É: $line"
    continue
  fi
  
  # –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Å—Ç—Ä–æ–∫–∏ —Å localhost –≤ INNGEST_BASE_URL
  if [[ $line == *"INNGEST_BASE_URL"*"localhost"* ]]; then
    echo "üóëÔ∏è –£–¥–∞–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–π URL: $line"
    continue
  fi
  
  # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –≤ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
  echo "$line" >> "$temp_file"
done < .env

# –î–æ–±–∞–≤–ª—è–µ–º –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –Ω–∞—Å—Ç—Ä–æ–π–∫—É –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
echo "" >> "$temp_file"
echo "# Production Inngest settings" >> "$temp_file"
echo "INNGEST_BASE_URL=https://api.inngest.com" >> "$temp_file"

# –ó–∞–º–µ–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
mv "$temp_file" .env

echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Inngest —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω—ã!"
echo "üìã –ù–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:"
grep "INNGEST_\|host.docker" .env

echo "üîÑ –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:"
echo "docker-compose down && docker-compose up -d" 