# CHANGELOG

## [2023-06-08]

### Added
- Создан класс `TelegrafBotTester` для тестирования ботов Telegram:
  - Реализация в `src/test-utils/testers/TelegrafBotTester.ts`
  - Поддержка симуляции обмена сообщениями с ботом
  - Возможность проверки отправленных ботом сообщений и кнопок
  - Симуляция нажатий на инлайн-кнопки
  - Проверка перехода между сценариями
- Добавлены тесты для аватар-ботов:
  - Базовые тесты взаимодействия в `src/test-utils/tests/bots/avatarBotTest.ts`
  - Тесты отправки изображений аватар-ботом
- Обновлен интерфейс `AvatarBot` с добавлением поддержки URL аватарки
- Добавлен скрипт `run-avatar-bot-tests.sh` для запуска тестов аватар-ботов
- Добавлены команды `test:avatar-bot` и `docker:test:avatar-bot` в package.json

### Changed
- Обновлены константы в файле `test-config.ts` для тестирования аватар-ботов
- Расширена документация по тестированию ботов в `src/test-utils/testers/README.md`

### Fixed
- Исправлены ошибки типизации в `createMockAvatarBot`
- Удалены неиспользуемые импорты

## [2023-06-07]

### Changed
- Улучшена структура тестов:
  - Перемещены все скрипты запуска тестов платежей в директорию `src/test-utils/payment/`
  - Обновлены bash-скрипты для использования новых путей
  - Обновлены команды в package.json для запуска тестов из новых локаций
- Обновлена документация в `docs/TESTING.md` с учетом новой структуры

### Added
- Добавлен новый скрипт `run-simple-receipt-test.sh` для запуска теста простой генерации чека
- Добавлена новая команда `simple-receipt-test` в package.json

## [2023-06-06]

### Added
- Добавлены тесты для функции createSuccessfulPayment:
  - Тест успешного создания платежа
  - Тест обработки дублирующихся платежей с одинаковым inv_id
  - Тест обработки платежей для несуществующих пользователей
  - Тест проверки существования платежа по inv_id
- Тесты для платежных чеков с возможностью запуска через bash-скрипты
- Скрипт `run-receipt-tests.sh` для запуска тестов платежных чеков
- Скрипт `run-payment-tests.sh` для запуска всех тестов платежной системы
- Новый тест `simpleReceiptTest.ts` для простой проверки генерации чеков

### Fixed
- Улучшена функция createSuccessfulPayment:
  - Добавлена проверка на существующий inv_id для предотвращения дублирования платежей
  - Добавлено возвращение существующего платежа вместо создания дубликата
- Переписаны тесты для использования собственной системы моков вместо Jest
- Исправлены имена функций и импорты в тестах платежных чеков

### Changed
- Обновлена документация по платежной системе
- Улучшен пользовательский интерфейс выбора модели
- Добавлены эмодзи-индикаторы для платных моделей
- Расширены тестовые сценарии для платежной системы
- Обновлена документация по тестированию в `docs/TESTING.md`
- Добавлены новые скрипты в package.json для запуска разных типов тестов

## [2023-06-05]

### Added
- Интеграция с платежной системой для SelectModelWizard
- Поддержка платных моделей с визуальной маркировкой
- Система подтверждения выбора платной модели
- Тесты для платежной интеграции с SelectModelWizard

### Fixed
- Улучшена обработка ошибок при недостаточном балансе
- Исправлена типизация платежных параметров

### Changed
- Обновлена документация по платежной системе
- Улучшен пользовательский интерфейс выбора модели
- Добавлены эмодзи-индикаторы для платных моделей
- Расширены тестовые сценарии для платежной системы

## [2023-04-10]

### Added
- Initial commit
- Basic telegram bot functionality
- Base payment structure

## [Unreleased]

### Fixed
- Исправлен расчет баланса пользователя: теперь функция `get_user_balance` использует тот же алгоритм, что и `get_user_balance_stats`, включая учет системных транзакций. Это устраняет несоответствие между отображаемыми значениями баланса в разных частях приложения.
- Исправлена ошибка линтера в `src/test-utils/tests/payment/paymentProcessorMockTest.ts` - удален неиспользуемый импорт `inngestTestEngine`.

### Added
- Добавлена документация по конфигурации Nginx:
  - Создан файл `docs/NGINX-CONFIG.md` с подробным описанием структуры конфигурации Nginx в проекте
  - Добавлен раздел о конфигурации Nginx в `README.md`
  - Добавлено описание всех используемых файлов конфигурации и их назначения для разных сред (разработка, тестирование, продакшн)

## [2023-06-09]

### Added
- Обновлен функционал отправки медиа в канал @neuro_blogger_pulse:
  - Добавлена новая функция `sendMediaToPulse` в `src/helpers/pulse.ts` с поддержкой различных типов медиа (фото, видео, аудио, документы)
  - Созданы тесты для функции `sendMediaToPulse` в `src/test-utils/tests/pulse/pulseMediaTest.ts`
  - Добавлены тесты интеграции с Inngest-функциями в `src/test-utils/tests/pulse/pulseIntegrationTest.ts`
  - Добавлены скрипты для запуска тестов: `scripts/run-pulse-tests.sh`
  - Добавлены соответствующие команды в package.json: `test:pulse` и `pulse-tests`

### Changed
- Обновлены Inngest-функции для использования новой функции `sendMediaToPulse`:
  - Обновлен `src/inngest-functions/neuroImageGeneration.ts`
  - Обновлен `src/inngest-functions/textToImage.inngest.ts`
  - `src/inngest-functions/textToVideo.inngest.ts` уже использовал новую функцию

### Fixed
- Оптимизирована обработка ошибок при отправке медиа
- Улучшена типизация параметров для функции отправки медиа
- Добавлены дополнительные проверки при формировании caption для отправляемых медиа 