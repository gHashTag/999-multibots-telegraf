# NeuroPhoto One - Модуль тестирования

## Описание
NeuroPhoto One - модуль для тестирования генерации фотореалистичных портретов  мужчин с использованием OpenAI для создания промптов и Replicate API для генерации изображений. Модуль отправляет результаты в Telegram группу или личный чат, а также сохраняет логи для дальнейшего анализа.

## ВАЖНО!!!
**НЕ СОЗДАВАЙТЕ ОТДЕЛЬНЫЕ ТЕСТЫ ДЛЯ КАЖДОЙ ЧАСТИ ФУНКЦИОНАЛА!**
**ОДИН ТЕСТ = ОДНА ФУНКЦИЯ. ВСЕГДА ИСПОЛЬЗУЙТЕ ЕДИНЫЙ ТЕСТ ДЛЯ ВСЕГО ПРОЦЕССА.**

## Структура директорий
```
src/test-utils/tests/neuro/neuro-photo-one/
├── index.ts              # Основной файл теста
├── gptPromptGenerator.ts # Генератор промптов с использованием OpenAI
├── testOnlyPrompt.ts     # Вспомогательный файл для тестирования только промптов (для отладки)
├── README.md             # Документация модуля
├── ROADMAP.md            # Дорожная карта развития
└── logs/                 # Директория для хранения логов
    ├── api_responses/    # Логи ответов API
    └── prompts/          # Сохраненные промпты
```

## Переменные окружения
Тесты используют следующие переменные из файла `.env.test`:

## Компоненты теста

### 1. Генерация промпта (OpenAI)
- Использует существующий клиент OpenAI из src/core/openai
- Генерирует детальный англоязычный промпт для лысого мужчины
- Сохраняет результат в логи для анализа

### 2. Генерация изображения (Replicate API)
- Использует функцию generateNeuroPhotoDirect из src/services
- Принимает промпт, сгенерированный OpenAI
- Обрабатывает платеж и генерирует изображение

### 3. Отправка результатов (Telegram)
- Отправляет прогресс и результаты в группу Telegram
- Пытается отправить изображение напрямую или URL, если не удалось

## Запуск теста
Для запуска полного теста используйте следующую команду:
```bash
NODE_ENV=test ts-node -r tsconfig-paths/register src/test-utils/tests/neuro/neuro-photo-one/index.ts
```

Для запуска с конкретным ID пользователя Telegram:
```bash
NEUROPHOTO_TELEGRAM_ID=@username NODE_ENV=test ts-node -r tsconfig-paths/register src/test-utils/tests/neuro/neuro-photo-one/index.ts
```

### Отладка отдельных компонентов
В редких случаях, для отладки отдельных компонентов, можно использовать вспомогательные тесты:

```bash
# Только для отладки генерации промпта
NODE_ENV=test ts-node -r tsconfig-paths/register src/test-utils/tests/neuro/neuro-photo-one/testOnlyPrompt.ts
```

**Примечание:** Это только для отладки! Не добавляйте новые тесты для отдельных компонентов!

## Важные зависимости
- Telegraf - для работы с Telegram API
- OpenAI клиент - для генерации промптов
- Replicate API - для генерации изображений

## Отладка
Все логи сохраняются в директории `logs/` со следующими префиксами:
- `gpt-response-` - ответы от OpenAI
- `generation-result-` - результаты генерации изображений

## Требования
1. Добавить бота в группу с ID `@neuro_blogger_pulse`
2. Наличие токена OpenAI API
3. Наличие токена Replicate API

## Известные проблемы
- Если бот не добавлен в группу, тест завершится с ошибкой "chat not found"
- При отсутствии любого из токенов тест не будет работать корректно 