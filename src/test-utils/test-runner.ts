#!/usr/bin/env node
/**
 * –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
 * –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
 *   ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts [—Ç–∏–ø —Ç–µ—Å—Ç–∞]
 *
 * –ü—Ä–∏–º–µ—Ä—ã:
 *   ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts webhook
 *   ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts database
 *   ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts all
 */

import {
  ReplicateWebhookTester,
  BFLWebhookTester,
  NeurophotoWebhookTester,
} from './webhook-tests'
import { DatabaseTester } from './database-tests'
import { InngestTester } from './inngest-tests'
import { logger } from '@/utils/logger'
import { TEST_CONFIG } from './test-config'
import fs from 'fs'
import path from 'path'

// –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
const colors = {
  reset: '\x1b[0m',
  bright: '\x1b[1m',
  dim: '\x1b[2m',
  red: '\x1b[31m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  blue: '\x1b[34m',
  magenta: '\x1b[35m',
  cyan: '\x1b[36m',
}

/**
 * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –≤—ã–≤–æ–¥–∞ –≤ –∫–æ–Ω—Å–æ–ª—å
 */
function formatResults(results, testType: string) {
  console.log(
    `\n${colors.bright}${colors.blue}=== –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ ${testType} ===${colors.reset}\n`
  )

  const successful = results.filter(r => r.success).length
  const total = results.length

  console.log(
    `${colors.bright}–í—ã–ø–æ–ª–Ω–µ–Ω–æ: ${total} | –£—Å–ø–µ—à–Ω–æ: ${
      successful === total ? colors.green : colors.yellow
    }${successful}${colors.reset}/${total} | –û—à–∏–±–æ–∫: ${
      total - successful > 0 ? colors.red : colors.green
    }${total - successful}${colors.reset}\n`
  )

  results.forEach((result, index) => {
    const statusColor = result.success ? colors.green : colors.red
    const status = result.success ? '‚úÖ –£–°–ü–ï–•' : '‚ùå –û–®–ò–ë–ö–ê'
    const duration = result.duration ? `(${result.duration}–º—Å)` : ''

    console.log(
      `${index + 1}. ${statusColor}${status}${colors.reset} ${colors.bright}${
        result.testName
      }${colors.reset} ${colors.yellow}${duration}${colors.reset}`
    )
    console.log(`   ${result.message}`)

    if (!result.success && result.error) {
      console.log(`   ${colors.red}–û—à–∏–±–∫–∞: ${result.error}${colors.reset}`)
    }

    console.log('')
  })

  // –ï—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Ö –≤ —Ñ–∞–π–ª
  if (TEST_CONFIG.options.saveResults) {
    saveResults(results, testType)
  }

  return { successful, total }
}

/**
 * –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ –≤ —Ñ–∞–π–ª
 */
function saveResults(results, testType) {
  try {
    const resultsDir = TEST_CONFIG.options.resultsPath

    // –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
    if (!fs.existsSync(resultsDir)) {
      fs.mkdirSync(resultsDir, { recursive: true })
    }

    const timestamp = new Date().toISOString().replace(/:/g, '-')
    const filename = `${testType}-tests-${timestamp}.json`
    const filePath = path.join(resultsDir, filename)

    fs.writeFileSync(
      filePath,
      JSON.stringify(
        {
          timestamp,
          testType,
          results,
          summary: {
            total: results.length,
            successful: results.filter(r => r.success).length,
          },
        },
        null,
        2
      )
    )

    logger.info({
      message: 'üíæ –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
      description: 'Test results saved',
      filePath,
    })
  } catch (error) {
    logger.error({
      message: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
      description: 'Error saving test results',
      error: error.message,
    })
  }
}

/**
 * –í—ã–≤–æ–¥–∏—Ç —Å–ø—Ä–∞–≤–∫—É –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å–∫—Ä–∏–ø—Ç–∞
 */
function printHelp() {
  console.log(`
${colors.bright}${colors.blue}–°–ö–†–ò–ü–¢ –ó–ê–ü–£–°–ö–ê –¢–ï–°–¢–û–í${colors.reset}

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ: ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts [—Ç–∏–ø-—Ç–µ—Å—Ç–æ–≤] [–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]${colors.reset}

${colors.bright}–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–∏–ø—ã —Ç–µ—Å—Ç–æ–≤:${colors.reset}
  ${colors.cyan}webhook${colors.reset}    - –¢–µ—Å—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤ Replicate
  ${colors.cyan}bfl-webhook${colors.reset} - –¢–µ—Å—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤ BFL
  ${colors.cyan}neurophoto-webhook${colors.reset} - –¢–µ—Å—Ç—ã –≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ
  ${colors.cyan}database${colors.reset}   - –¢–µ—Å—Ç—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
  ${colors.cyan}inngest${colors.reset}    - –¢–µ—Å—Ç—ã Inngest —Ñ—É–Ω–∫—Ü–∏–π
  ${colors.cyan}neuro${colors.reset}      - –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  ${colors.cyan}neurophoto-v2${colors.reset} - –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2
  ${colors.cyan}function${colors.reset}   - –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö Inngest —Ñ—É–Ω–∫—Ü–∏–π (—Ç—Ä–µ–±—É–µ—Ç—Å—è —É–∫–∞–∑–∞—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏)
  ${colors.cyan}voice-avatar${colors.reset} - –¢–µ—Å—Ç—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
  ${colors.cyan}all${colors.reset}        - –í—Å–µ —Ç–µ—Å—Ç—ã

${colors.bright}–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:${colors.reset}
  ${colors.cyan}--dry-run${colors.reset}        - –ó–∞–ø—É—Å–∫ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (—Ç–æ–ª—å–∫–æ –¥–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–µ—Å—Ç–æ–≤)
  ${colors.cyan}--debug-endpoint${colors.reset}  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç (–¥–ª—è –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ)

${colors.bright}–ü—Ä–∏–º–µ—Ä—ã:${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts webhook${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts bfl-webhook${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neurophoto-webhook${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neurophoto-webhook --dry-run${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neurophoto-webhook --debug-endpoint${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neurophoto-webhook --dry-run --debug-endpoint${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts database${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts inngest${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neuro${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts neurophoto-v2${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts function hello-world${colors.reset}
  ${colors.cyan}ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts all${colors.reset}

${colors.bright}–î–æ—Å—Ç—É–ø–Ω—ã–µ Inngest —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:${colors.reset}
  ${colors.cyan}hello-world${colors.reset}       - –ü—Ä–æ—Å—Ç–∞—è —Ç–µ—Å—Ç–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è
  ${colors.cyan}broadcast${colors.reset}         - –§—É–Ω–∫—Ü–∏—è –º–∞—Å—Å–æ–≤–æ–π —Ä–∞—Å—Å—ã–ª–∫–∏
  ${colors.cyan}payment${colors.reset}           - –§—É–Ω–∫—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π
  ${colors.cyan}model-training${colors.reset}    - –§—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π
  ${colors.cyan}model-training-v2${colors.reset} - –§—É–Ω–∫—Ü–∏—è —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –º–æ–¥–µ–ª–µ–π v2
  ${colors.cyan}neuro${colors.reset}             - –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  ${colors.cyan}neurophoto-v2${colors.reset}     - –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2
  ${colors.cyan}voice-avatar${colors.reset}       - –§—É–Ω–∫—Ü–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞
  `)
}

/**
 * –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤
 */
async function main() {
  const args = process.argv.slice(2)
  const testType = args[0]?.toLowerCase() || 'all'

  // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ–±—â–µ–≥–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ç–µ—Å—Ç–æ–≤
  let allSuccessful = true

  // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ —Ñ–ª–∞–≥–æ–≤
  const dryRun = args.includes('--dry-run')
  const useDebugEndpoint = args.includes('--debug-endpoint')

  console.log(
    `\n${colors.bright}${colors.blue}üß™ –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í${colors.reset}\n`
  )
  console.log(`–¢–∏–ø —Ç–µ—Å—Ç–æ–≤: ${colors.cyan}${testType}${colors.reset}`)
  if (dryRun) {
    console.log(
      `${colors.yellow}–†–µ–∂–∏–º: dry run (–±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö)${colors.reset}`
    )
  }
  if (useDebugEndpoint) {
    console.log(
      `${colors.yellow}–†–µ–∂–∏–º: –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ—Ç–ª–∞–¥–æ—á–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞${colors.reset}`
    )
  }
  console.log(
    `URL API: ${colors.cyan}${TEST_CONFIG.server.apiUrl}${colors.reset}`
  )

  if (['webhook', 'all'].includes(testType)) {
    console.log(
      `–ü—É—Ç—å –≤–µ–±—Ö—É–∫–∞ Replicate: ${colors.cyan}${TEST_CONFIG.server.webhookPath}${colors.reset}\n`
    )
  }

  if (['bfl-webhook', 'all'].includes(testType)) {
    console.log(
      `–ü—É—Ç—å –≤–µ–±—Ö—É–∫–∞ BFL: ${colors.cyan}${TEST_CONFIG.server.bflWebhookPath}${colors.reset}\n`
    )
  }

  if (['neurophoto-webhook', 'all'].includes(testType)) {
    console.log(
      `–ü—É—Ç—å –≤–µ–±—Ö—É–∫–∞ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ: ${colors.cyan}${TEST_CONFIG.server.neurophotoWebhookPath}${colors.reset}\n`
    )
  }

  if (['inngest', 'neuro', 'all'].includes(testType)) {
    const inngestUrl = process.env.INNGEST_DEV_URL || 'http://localhost:8288'
    console.log(
      `URL Inngest Dev Server: ${colors.cyan}${inngestUrl}${colors.reset}`
    )
  }

  console.log('')

  try {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∫–∞–∫–∏–µ —Ç–µ—Å—Ç—ã –∑–∞–ø—É—Å–∫–∞—Ç—å
    if (testType === 'webhook' || testType === 'all') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤ Replicate',
        description: 'Starting Replicate webhook tests',
      })

      const webhookTester = new ReplicateWebhookTester()
      const webhookResults = await webhookTester.runAllTests()
      formatResults(webhookResults, '–≤–µ–±—Ö—É–∫–æ–≤ Replicate')
    }

    if (testType === 'bfl-webhook' || testType === 'all') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤ BFL',
        description: 'Starting BFL webhook tests',
      })

      const bflWebhookTester = new BFLWebhookTester()
      const bflWebhookResults = await bflWebhookTester.runAllTests()
      formatResults(bflWebhookResults, '–≤–µ–±—Ö—É–∫–æ–≤ BFL')
    }

    if (testType === 'neurophoto-webhook' || testType === 'all') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ',
        description: 'Starting neurophoto webhook tests',
        dryRun,
        useDebugEndpoint,
      })

      const neurophotoWebhookTester = new NeurophotoWebhookTester()
      const neurophotoWebhookResults =
        await neurophotoWebhookTester.runAllTests({
          checkDatabase: !dryRun,
          useDebugEndpoint,
        })
      const { successful, total } = formatResults(
        neurophotoWebhookResults,
        '–≤–µ–±—Ö—É–∫–æ–≤ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ'
      )
      allSuccessful = allSuccessful && successful === total
    }

    if (testType === 'database' || testType === 'all') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö',
        description: 'Starting database tests',
      })

      const dbTester = new DatabaseTester()
      const dbResults = await dbTester.runAllTests()
      formatResults(dbResults, '–±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö')
    }

    if (testType === 'inngest' || testType === 'all') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ Inngest —Ñ—É–Ω–∫—Ü–∏–π',
        description: 'Starting Inngest function tests',
      })

      const inngestTester = new InngestTester()
      const inngestResults = await inngestTester.runAllTests()
      formatResults(inngestResults, 'Inngest —Ñ—É–Ω–∫—Ü–∏–π')
    }

    if (testType === 'neuro') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π',
        description: 'Starting image generation tests',
      })

      const inngestTester = new InngestTester()
      const neuroResults = await inngestTester.runImageGenerationTests()

      // –¢–∞–∫–∂–µ –∑–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã NeuroPhoto V2 –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤ neuro
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2',
        description: 'Starting NeuroPhoto V2 generation tests',
      })

      // –î–æ–±–∞–≤–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–æ–≤ NeuroPhoto V2 –∫ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º –æ–±—ã—á–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
      const neuroPhotoV2Results = await inngestTester.runSpecificFunctionTests(
        'neurophoto-v2'
      )
      const allNeuroResults = [...neuroResults, ...neuroPhotoV2Results]

      formatResults(allNeuroResults, '–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π')
    }

    if (testType === 'neurophoto-v2') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2',
        description: 'Starting NeuroPhoto V2 generation tests',
      })

      const inngestTester = new InngestTester()
      const neuroPhotoV2Results = await inngestTester.runSpecificFunctionTests(
        'neurophoto-v2'
      )
      formatResults(neuroPhotoV2Results, '–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2')
    }

    if (testType === 'function') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö Inngest —Ñ—É–Ω–∫—Ü–∏–π',
        description: 'Starting specific Inngest function tests',
      })

      const functionName = args[1]
      if (!functionName) {
        console.log(
          `${colors.red}–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —É–∫–∞–∑–∞—Ç—å –∏–º—è —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!${colors.reset}\n`
        )
        console.log(
          `${colors.cyan}–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: hello-world, broadcast, payment, model-training, model-training-v2, neuro, neurophoto-v2, voice-avatar${colors.reset}\n`
        )
        console.log(
          `${colors.cyan}–ü—Ä–∏–º–µ—Ä: ts-node -r tsconfig-paths/register src/test-utils/test-runner.ts function hello-world${colors.reset}\n`
        )
        printHelp()
        process.exit(1)
      }

      const inngestTester = new InngestTester()
      const functionResults = await inngestTester.runSpecificFunctionTests(
        functionName
      )
      formatResults(functionResults, `Inngest —Ñ—É–Ω–∫—Ü–∏–∏ "${functionName}"`)
    }

    if (testType === 'voice-avatar') {
      logger.info({
        message: 'üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞',
        description: 'Starting voice avatar tests',
      })

      const inngestTester = new InngestTester()
      const voiceAvatarResults = await inngestTester.runVoiceAvatarTests()
      formatResults(voiceAvatarResults, '–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –∞–≤–∞—Ç–∞—Ä–∞')
    }

    if (testType === 'help' || testType === '--help' || testType === '-h') {
      printHelp()
    }

    if (
      ![
        'webhook',
        'bfl-webhook',
        'neurophoto-webhook',
        'database',
        'inngest',
        'neuro',
        'neurophoto-v2',
        'function',
        'voice-avatar',
        'all',
        'help',
        '--help',
        '-h',
      ].includes(testType)
    ) {
      console.log(
        `${colors.red}–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø —Ç–µ—Å—Ç–æ–≤: ${testType}${colors.reset}\n`
      )
      printHelp()
    }
  } catch (error) {
    logger.error({
      message: '‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ —Ç–µ—Å—Ç–æ–≤',
      description: 'Error running tests',
      error: error.message,
      stack: error.stack,
    })

    console.log(
      `\n${colors.red}${colors.bright}–û–®–ò–ë–ö–ê: ${error.message}${colors.reset}\n`
    )
    process.exit(1)
  }
}

// –ó–∞–ø—É—Å–∫–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é, –µ—Å–ª–∏ —Ñ–∞–π–ª –∑–∞–ø—É—â–µ–Ω –Ω–∞–ø—Ä—è–º—É—é
if (require.main === module) {
  main().catch(error => {
    console.error(`Critical error: ${error.message}`)
    process.exit(1)
  })
}
