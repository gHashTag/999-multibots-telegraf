# Тестирование функциональности Audio-to-Text

## Общая информация

Данный документ описывает тестирование функциональности преобразования аудио в текст (Audio-to-Text) с использованием API Whisper от OpenAI. Функциональность поддерживает обработку как коротких, так и длинных аудиофайлов (до 2 часов), а также возможность извлечения аудиодорожки из видеофайлов.

## Реализованные компоненты
✅ Сцена `audioToTextScene` для взаимодействия с пользователем
✅ Сервисные функции для транскрипции аудио в `openai-service.ts`
✅ Функции для обработки файлов аудио и видео в `ffmpeg-service.ts`
✅ Inngest функция `audioToTextFunction` для асинхронной обработки аудио
✅ Расчет стоимости транскрипции в зависимости от модели и длительности

## Структура тестов

Тесты для функциональности Audio-to-Text разделены на следующие группы:

### 1. Базовые тесты функциональности

- ✅ Вход в сцену и отображение инструкций
- ✅ Загрузка и обработка короткого аудиофайла (до 10 минут)
- ✅ Загрузка и обработка длинного аудиофайла (более 1 часа)
- ✅ Обработка видеофайла с извлечением аудиодорожки
- ✅ Локализация (русский и английский)

### 2. Тесты обработки различных форматов и ошибок

- ✅ Обработка ошибок при загрузке неподдерживаемых файлов
- ✅ Поддержка различных форматов аудио (MP3, WAV, OGG, M4A)
- ✅ Функция экспорта результатов в различные форматы
- ✅ Настройка параметров транскрипции

## Поддерживаемые форматы

### Аудио форматы
- MP3 (.mp3)
- WAV (.wav)
- OGG (.ogg)
- M4A (.m4a)
- Аудиосообщения Telegram (голосовые сообщения)

### Видео форматы
- MP4 (.mp4)
- AVI (.avi)
- MOV (.mov)
- WebM (.webm)

## Модели транскрипции

Функциональность использует следующие модели OpenAI Whisper для транскрипции:
- Whisper Tiny - базовая модель (низкая точность, быстрая обработка)
- Whisper Base - улучшенная базовая модель
- Whisper Small - модель среднего уровня
- Whisper Medium - продвинутая модель (рекомендуется по умолчанию)
- Whisper Large - самая продвинутая модель (высокая точность, медленная обработка)

## Инструкция по запуску тестов

```bash
# Запуск всех тестов аудио-в-текст
cd /Users/playom/999-multibots-telegraf
./src/test-utils/run-audio-to-text-tests.sh

# Запуск только базового теста
npx tsx src/test-utils/simplest-test-audio-to-text.ts
```

## Тестовые файлы

Тестовые аудио и видео файлы для тестирования функциональности хранятся в директории:
`src/test-utils/test-data/audio-to-text/`

## Информация о прогрессе разработки

- **Дата начала разработки:** [ДАТА]
- **Дата завершения разработки:** [ТЕКУЩАЯ ДАТА]
- **Статус реализации:** ✅ Завершено
- **Количество строк кода:** ~1000

## Примечания и будущие улучшения

- Добавить поддержку дополнительных языков
- Реализовать распознавание ключевых слов и фраз
- Добавить функцию автоматического создания саммари по транскрипции
- Реализовать кэширование результатов транскрипции для повторного использования 