#!/bin/bash
# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –º–µ–¥–∏–∞-—Ñ—É–Ω–∫—Ü–∏–π: –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ, —Ç–µ–∫—Å—Ç-–≤-–≤–∏–¥–µ–æ, –∞—É–¥–∏–æ-–≤-—Ç–µ–∫—Å—Ç, –∏ —Ç.–¥.

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
MAGENTA='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m' # No Color

echo -e "${MAGENTA}=================================================${NC}"
echo -e "${MAGENTA}       üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ–¥–∏–∞-—Ñ—É–Ω–∫—Ü–∏–π            ${NC}"
echo -e "${MAGENTA}=================================================${NC}"

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
export TEST=true
export NODE_ENV=test

# –¢–µ–∫—É—â–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è —Å–∫—Ä–∏–ø—Ç–æ–≤
DIR="/Users/playom/999-multibots-telegraf/src/test-utils"

# –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è –æ–±—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
TOTAL_TESTS=0
PASSED_TESTS=0
FAILED_TESTS=0

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–¥—Å—á–µ—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∞
count_results() {
  local success=$1
  TOTAL_TESTS=$((TOTAL_TESTS + 1))
  if [ $success -eq 0 ]; then
    PASSED_TESTS=$((PASSED_TESTS + 1))
  else
    FAILED_TESTS=$((FAILED_TESTS + 1))
  fi
}

# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
start_time_global=$(date +%s)

# 1. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ (Flux)
echo -e "\n${CYAN}üñºÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ (Flux)...${NC}"
$DIR/run-neurophoto-tests.sh
count_results $?

# 2. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2 (Flux Pro)
echo -e "\n${CYAN}üñºÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–µ–π—Ä–æ—Ñ–æ—Ç–æ V2 (Flux Pro)...${NC}"
$DIR/run-neurophoto-v2-tests.sh
count_results $?

# 3. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã —Ç–µ–∫—Å—Ç-–≤-–≤–∏–¥–µ–æ
echo -e "\n${CYAN}üé¨ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç–µ–∫—Å—Ç-–≤-–≤–∏–¥–µ–æ...${NC}"
node $DIR/simplest-test-text-to-video.js
count_results $?

# 4. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–≤-–≤–∏–¥–µ–æ
echo -e "\n${CYAN}üé¨ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–≤-–≤–∏–¥–µ–æ...${NC}"
node $DIR/simplest-test-image-to-video.js
count_results $?

# 5. –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç—ã –∞—É–¥–∏–æ-–≤-—Ç–µ–∫—Å—Ç
echo -e "\n${CYAN}üéôÔ∏è –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ –∞—É–¥–∏–æ-–≤-—Ç–µ–∫—Å—Ç...${NC}"
$DIR/run-audio-to-text-tests.sh
count_results $?

end_time_global=$(date +%s)
execution_time=$((end_time_global - start_time_global))

# –í—ã–≤–æ–¥–∏–º —Å–≤–æ–¥–Ω—É—é —Ç–∞–±–ª–∏—Ü—É —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
echo -e "\n${MAGENTA}=================================================${NC}"
echo -e "${YELLOW}üìä –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–µ–¥–∏–∞-—Ñ—É–Ω–∫—Ü–∏–π:${NC}"
echo -e "${MAGENTA}=================================================${NC}"
echo -e "| ${CYAN}–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å${NC}             | ${CYAN}–°—Ç–∞—Ç—É—Å${NC}     |"
echo -e "|------------------------------|------------|"

# –°—Ç–∞—Ç—É—Å –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
if [ $PASSED_TESTS -eq $TOTAL_TESTS ]; then
  echo -e "| –ù–µ–π—Ä–æ–§–æ—Ç–æ (Flux)              | ${GREEN}‚úÖ –£—Å–ø–µ—Ö${NC}   |"
  echo -e "| –ù–µ–π—Ä–æ–§–æ—Ç–æ V2 (Flux Pro)       | ${GREEN}‚úÖ –£—Å–ø–µ—Ö${NC}   |"
  echo -e "| –¢–µ–∫—Å—Ç-–≤-–í–∏–¥–µ–æ                 | ${GREEN}‚úÖ –£—Å–ø–µ—Ö${NC}   |"
  echo -e "| –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–≤-–í–∏–¥–µ–æ           | ${GREEN}‚úÖ –£—Å–ø–µ—Ö${NC}   |"
  echo -e "| –ê—É–¥–∏–æ-–≤-–¢–µ–∫—Å—Ç                 | ${GREEN}‚úÖ –£—Å–ø–µ—Ö${NC}   |"
else
  # –ó–¥–µ—Å—å –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏–∏ –Ω—É–∂–Ω–æ –±—ã–ª–æ –±—ã –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å –∫–∞–∂–¥–æ–≥–æ —Ç–µ—Å—Ç–∞ –æ—Ç–¥–µ–ª—å–Ω–æ
  echo -e "| –ù–µ–π—Ä–æ–§–æ—Ç–æ (Flux)              | ${RED}‚ùå –û—à–∏–±–∫–∞${NC}  |"
  echo -e "| –ù–µ–π—Ä–æ–§–æ—Ç–æ V2 (Flux Pro)       | ${RED}‚ùå –û—à–∏–±–∫–∞${NC}  |"
  echo -e "| –¢–µ–∫—Å—Ç-–≤-–í–∏–¥–µ–æ                 | ${RED}‚ùå –û—à–∏–±–∫–∞${NC}  |"
  echo -e "| –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ-–≤-–í–∏–¥–µ–æ           | ${RED}‚ùå –û—à–∏–±–∫–∞${NC}  |"
  echo -e "| –ê—É–¥–∏–æ-–≤-–¢–µ–∫—Å—Ç                 | ${RED}‚ùå –û—à–∏–±–∫–∞${NC}  |"
fi

echo -e "${MAGENTA}=================================================${NC}"
echo -e "–í—Å–µ–≥–æ –Ω–∞–±–æ—Ä–æ–≤ —Ç–µ—Å—Ç–æ–≤: ${CYAN}$TOTAL_TESTS${NC}"
echo -e "–£—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω–æ: ${GREEN}$PASSED_TESTS${NC}"
echo -e "–° –æ—à–∏–±–∫–∞–º–∏: ${RED}$FAILED_TESTS${NC}"
echo -e "‚è±Ô∏è –û–±—â–µ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${YELLOW}$execution_time —Å–µ–∫—É–Ω–¥${NC}"

# –ò—Ç–æ–≥–æ–≤—ã–π —Å—Ç–∞—Ç—É—Å
if [ $FAILED_TESTS -eq 0 ]; then
  echo -e "\n${GREEN}üéâ –í—Å–µ —Ç–µ—Å—Ç—ã –º–µ–¥–∏–∞-—Ñ—É–Ω–∫—Ü–∏–π —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω—ã!${NC}"
  exit 0
else
  echo -e "\n${RED}‚ùå –û–±–Ω–∞—Ä—É–∂–µ–Ω—ã –æ—à–∏–±–∫–∏ –≤ —Ç–µ—Å—Ç–∞—Ö –º–µ–¥–∏–∞-—Ñ—É–Ω–∫—Ü–∏–π. –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ.${NC}"
  exit 1
fi 