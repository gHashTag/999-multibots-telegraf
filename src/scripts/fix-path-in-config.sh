#!/bin/bash

# –°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é dist –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
mkdir -p dist

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–ø–∏–ª—è—Ü–∏—é
echo "üöÄ –ó–∞–ø—É—Å–∫ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ TypeScript..."
npm run build

echo "üîç –ü–æ–∏—Å–∫ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤ –≤ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞—Ö..."

# –ü–æ–∏—Å–∫ —Ñ–∞–π–ª–æ–≤ —Å –ø—Ä–æ–±–ª–µ–º–Ω—ã–º –∏–º–ø–æ—Ä—Ç–æ–º
echo "–§–∞–π–ª—ã —Å –∏–º–ø–æ—Ä—Ç–æ–º '../src/utils/logger':"
grep -r "../src/utils/logger" dist/ || echo "–ù–µ –Ω–∞–π–¥–µ–Ω–æ"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–π–ª dist/config/index.js –∏ –ø–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
if [ -f "dist/config/index.js" ]; then
  echo "üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ dist/config/index.js –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
  head -n 20 dist/config/index.js

  # –ó–∞–º–µ–Ω—è–µ–º '../src/utils/logger' –Ω–∞ '../utils/logger'
  echo "‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∏–º–ø–æ—Ä—Ç–∞..."
  sed -i 's/\.\.\/src\/utils\/logger/\.\.\/utils\/logger/g' dist/config/index.js
  
  echo "üìÑ –°–æ–¥–µ—Ä–∂–∏–º–æ–µ dist/config/index.js –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:"
  head -n 20 dist/config/index.js
else
  echo "‚ùå –§–∞–π–ª dist/config/index.js –Ω–µ –Ω–∞–π–¥–µ–Ω!"
fi

# –ó–∞–º–µ–Ω—è–µ–º 'Logger as logger' –Ω–∞ –ø—Ä–æ—Å—Ç–æ 'logger'
echo "‚úèÔ∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–º–ø–æ—Ä—Ç–æ–≤ Logger..."
find dist -type f -name "*.js" -exec sed -i 's/Logger as logger/logger/g' {} \;

# –ó–∞–º–µ–Ω—è–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –±–æ–ª–µ–µ –≥–ª–æ–±–∞–ª—å–Ω–æ
echo "‚úèÔ∏è –ì–ª–æ–±–∞–ª—å–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—É—Ç–µ–π –∏–º–ø–æ—Ä—Ç–∞..."
find dist -type f -name "*.js" -exec sed -i 's/\.\.\/src\//\.\.\//g' {} \;

echo "‚úèÔ∏è –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∫–∞—Ç–∞–ª–æ–≥–æ–≤ dist:"
find dist -type d | sort

echo "‚úÖ –ü—É—Ç–∏ –∏–º–ø–æ—Ä—Ç–∞ —É—Å–ø–µ—à–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã." 