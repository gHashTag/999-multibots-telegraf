# üê≥ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Docker

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É –ø—Ä–æ–µ–∫—Ç–∞ –≤ Docker.

## üìã –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker
- docker-compose

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞ —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏:

```
SUPABASE_URL=–≤–∞—à_url
SUPABASE_SERVICE_KEY=–≤–∞—à_–∫–ª—é—á
STRIPE_SECRET_KEY=–≤–∞—à_–∫–ª—é—á
STRIPE_WEBHOOK_SECRET=–≤–∞—à_–∫–ª—é—á
HOST_URL=–≤–∞—à_url
INNGEST_EVENT_KEY=–≤–∞—à_–∫–ª—é—á
INNGEST_SIGNING_KEY=–≤–∞—à_–∫–ª—é—á
OPENAI_API_KEY=–≤–∞—à_–∫–ª—é—á
ANTHROPIC_API_KEY=–≤–∞—à_–∫–ª—é—á
GOOGLE_API_KEY=–≤–∞—à_–∫–ª—é—á
GOOGLE_CSE_ID=–≤–∞—à_id
CLOUDFLARE_ACCOUNT_ID=–≤–∞—à_id
CLOUDFLARE_API_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
TELEGRAM_BOT_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
TELEGRAM_WEBVIEW_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
REPLICATE_API_TOKEN=–≤–∞—à_—Ç–æ–∫–µ–Ω
MISTRAL_API_KEY=–≤–∞—à_–∫–ª—é—á
```

### 2. SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å HTTPS —Å–æ–∑–¥–∞–π—Ç–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤:

```bash
mkdir -p certbot/conf certbot/www
```

## üöÄ –ó–∞–ø—É—Å–∫

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Docker:

```bash
npm run check:docker
```

### –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm run docker:up
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker-compose up -d
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
npm run docker:logs
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker-compose logs -f
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

```bash
npm run docker:down
```

–ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é:

```bash
docker-compose down
```

## üß™ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

–î–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –≤ Docker:

```bash
npm run test:docker
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç —Ç–µ—Å—Ç—ã –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ Docker –∏ –æ—Ç–æ–±—Ä–∞–∑–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ç—Ä–∏ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker:

1. **Dockerfile** - –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ production –æ–±—Ä–∞–∑–∞
2. **docker-compose.yml** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ production —Å—Ä–µ–¥—ã
3. **Dockerfile.test** - —Ñ–∞–π–ª –¥–ª—è —Å–±–æ—Ä–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
4. **docker-compose.test.yml** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
‚îú‚îÄ‚îÄ Dockerfile            # –û—Å–Ω–æ–≤–Ω–æ–π Dockerfile –¥–ª—è production
‚îú‚îÄ‚îÄ Dockerfile.test       # Dockerfile –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è docker-compose –¥–ª—è production
‚îú‚îÄ‚îÄ docker-compose.test.yml  # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è docker-compose –¥–ª—è —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ configs/
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ check-docker.sh   # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ run-docker-tests.sh  # –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤ –≤ Docker
‚îî‚îÄ‚îÄ certbot/              # –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
    ‚îú‚îÄ‚îÄ conf/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤
    ‚îî‚îÄ‚îÄ www/              # –í–µ–±-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ–º–µ–Ω–∞
```

## üîç –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:

```bash
docker logs neuro-blogger-telegram-bot
```

### –ü—Ä–æ–±–ª–µ–º—ã —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª `.env` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

### –ü—Ä–æ–±–ª–µ–º—ã —Å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `SUPABASE_URL` –∏ `SUPABASE_SERVICE_KEY` —É–∫–∞–∑–∞–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

## SSH –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Å–µ—Ä–≤–µ—Ä—É

```bash
ssh -i ~/.ssh/id_rsa root@999-multibots-u14194.vm.elestio.app
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤

```bash
cd /opt/app/999-multibots-telegraf
docker compose down
docker-compose up --build -d
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker logs -f 999-multibots
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
cd /opt/app/999-multibots-telegraf
git pull
./update-docker.sh
```