# Модуль VideoGenerator

## Обзор

Модуль `videoGenerator` является независимым и модульным компонентом системы Telegram-бота, предназначенным для генерации видео из изображений или морфинга между двумя изображениями. Этот модуль разработан с учетом принципов модульности, переносимости и масштабируемости, чтобы его можно было легко интегрировать в различные проекты.

## Цель

Основная цель модуля `videoGenerator` - предоставить автономный функционал для генерации видео, который не зависит от конкретной реализации Telegram-бота или других внешних систем. Все зависимости передаются через параметры, что позволяет использовать модуль в разных контекстах.

## Структура модуля

Модуль организован в соответствии с принципом единственной ответственности, разделяя логику на небольшие, независимые компоненты:

- **config/**: Конфигурационные файлы.
  - `videoModels.ts`: Определение доступных моделей видео с их характеристиками (цена, поддержка морфинга и т.д.).
- **stages/**: Этапы процесса генерации видео (пока не реализованы, но зарезервированы для будущей декомпозиции).
- **helpers/**: Вспомогательные функции.
  - `determineVideoMode.ts`: Определение режима генерации видео (стандартный или морфинг) на основе контекста.
- **adapters/**: Адаптеры для интеграции с внешними системами.
  - `telegramConnector.ts`: Адаптер для взаимодействия с Telegram API, изолирующий логику отправки сообщений и видео.
- **__tests__/**: Тесты для проверки функциональности модуля.
  - `standard-mode.test.ts`: Тесты для стандартного режима генерации видео.
  - `morphing-mode.test.ts`: Тесты для режима морфинга.
  - `common-scenarios.test.ts`: Тесты для общих сценариев и обработки ошибок.
- `generateImageToVideo.ts`: Основная функция генерации видео, которая принимает все необходимые параметры и зависимости.
- `types.ts`: Определение типов, используемых в модуле, таких как `VideoModelConfig`.
- `index.ts`: Точка входа модуля, экспортирующая все ключевые компоненты.

## Использование

Для использования модуля `videoGenerator` в вашем проекте, импортируйте необходимые компоненты из `index.ts` и передайте зависимости через параметры функций. Пример:

```typescript
import { generateImageToVideo, TelegramConnector } from '@/modules/videoGenerator';

// Создание коннектора для Telegram
const connector = new TelegramConnector(telegram, chatId, isRu);

// Запуск генерации видео
await connector.startVideoGeneration(
  telegramId,
  username,
  botName,
  videoModel,
  imageUrl,
  prompt,
  isMorphing,
  imageAUrl,
  imageBUrl,
  dependencies
);
```

## Зависимости

Модуль не имеет жестко закодированных зависимостей. Все необходимые компоненты (API для генерации видео, доступ к базе данных, логирование и т.д.) передаются через объект `dependencies`, что обеспечивает гибкость и возможность замены реализаций.

## Тестирование

Модуль покрыт тестами на 100%, включая следующие сценарии:
- **Стандартный режим**: Генерация видео из одного изображения с текстовым промптом.
- **Режим морфинга**: Генерация видео на основе двух изображений.
- **Обработка ошибок**: Проверка случаев с недостаточным балансом, некорректными входными данными и неподдерживаемыми моделями.

Тесты находятся в папке `__tests__` и могут быть запущены с помощью команды `pnpm vitest run`.

## Будущие улучшения

- Добавление поддержки текстового режима генерации видео (`text-to-video`).
- Декомпозиция процесса генерации на этапы (`stages`) для более детального контроля.
- Расширение документации с примерами для каждого сценария использования.

## Поддерживаемые случаи использования

- **Стандартная генерация видео**: Создание видео на основе одного изображения и текстового описания.
- **Морфинг**: Плавный переход между двумя изображениями в видеоформате.
- **Будущий текстовый режим**: Генерация видео исключительно на основе текстового описания (в разработке).

## Ценообразование

Стоимость генерации видео зависит от выбранной модели и указана в `videoModels.ts`. Например:
- Stable Video Diffusion: 10 кредитов
- Kling v1.6 Pro: 15 кредитов (поддерживает морфинг)
- Minimax: 12 кредитов

Этот модуль является ключевым компонентом для создания нейро-турбо функционала в Telegram-боте и готов к интеграции в основную ветку проекта.

## Контакты

По вопросам или для внесения вклада, пожалуйста, свяжитесь с maintainers проекта или обратитесь к основному репозиторию проекта для получения дополнительной информации. 