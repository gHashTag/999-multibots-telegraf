#!/bin/bash

# üéØ Task Guardian - –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏ —Å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é

# –¶–≤–µ—Ç–æ–≤—ã–µ –∫–æ–¥—ã –¥–ª—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
PURPLE='\033[0;35m'
CYAN='\033[0;36m'
NC='\033[0m'

# –î–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á
TASKS_DIR="src/core/mcp/agent/memory-bank/NeuroBlogger/tasks"
ACTIVE_TASKS="$TASKS_DIR/active"
COMPLETED_TASKS="$TASKS_DIR/completed"
ARCHIVED_TASKS="$TASKS_DIR/archived"

# –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
mkdir -p "$ACTIVE_TASKS" "$COMPLETED_TASKS" "$ARCHIVED_TASKS"

# –ü—É—Ç—å –∫ ROADMAP.md
ROADMAP_PATH="src/core/mcp/agent/memory-bank/NeuroBlogger/ROADMAP.md"

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
show_greeting() {
    echo -e "${BLUE}ü§ñ –ü—Ä–∏–≤–µ—Ç! –Ø —Ç–≤–æ–π Task Guardian - –ø–æ–º–æ—â–Ω–∏–∫ –≤ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∞–º–∏!${NC}"
    echo -e "${BLUE}–Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ –æ—Ä–≥–∞–Ω–∏–∑–æ–≤–∞—Ç—å –∏ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ –≤ –ø—Ä–æ–µ–∫—Ç–µ.${NC}"
    echo
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
show_status() {
    echo -e "üìä –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å —Å–∏—Å—Ç–µ–º—ã:\n"
    sed -n '/## –ú–µ—Ç—Ä–∏–∫–∏/,/##/p' "$ROADMAP_PATH" | grep -E "^- " | head -n -1
    echo -e "\n"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á
show_tasks() {
    echo -e "üöÄ –¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏:\n"
    sed -n '/## –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞/,/##/p' "$ROADMAP_PATH" | grep -E "^- " | head -n -1
    echo -e "\n"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏
add_task() {
    echo -e "‚ûï –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π –∑–∞–¥–∞—á–∏\n"
    read -p "–í–≤–µ–¥–∏—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏: " task_description
    
    # –î–æ–±–∞–≤–ª—è–µ–º –∑–∞–¥–∞—á—É –≤ —Ä–∞–∑–¥–µ–ª —Ç–µ–∫—É—â–µ–π —Ä–∞–±–æ—Ç—ã
    sed -i '' "/## –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞/a\\
- $task_description" "$ROADMAP_PATH"
    
    echo -e "${GREEN}‚úÖ –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!${NC}\n"
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏
complete_task() {
    echo -e "‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏\n"
    echo "–¢–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏:"
    show_tasks
    read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏ –¥–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è: " task_number
    
    # –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –∏ –ø–µ—Ä–µ–º–µ—â–∞–µ–º –µ—ë –≤ —Ä–∞–∑–¥–µ–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö
    task=$(sed -n "/## –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞/,/##/p" "$ROADMAP_PATH" | grep -E "^- " | sed -n "${task_number}p")
    if [ ! -z "$task" ]; then
        # –£–¥–∞–ª—è–µ–º –∑–∞–¥–∞—á—É –∏–∑ —Ç–µ–∫—É—â–∏—Ö
        sed -i '' "/## –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞/,/##/{/$task/d;}" "$ROADMAP_PATH"
        # –î–æ–±–∞–≤–ª—è–µ–º –≤ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
        sed -i '' "/## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏/a\\
$task" "$ROADMAP_PATH"
        echo -e "${GREEN}‚úÖ –ó–∞–¥–∞—á–∞ —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!${NC}\n"
    else
        echo -e "${RED}‚ùå –ó–∞–¥–∞—á–∞ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–∞${NC}\n"
    fi
}

# –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –∑–∞–¥–∞—á
analyze_tasks() {
    echo -e "üîç –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á\n"
    total=$(sed -n '/## –¢–µ–∫—É—â–∞—è —Ä–∞–±–æ—Ç–∞/,/##/p' "$ROADMAP_PATH" | grep -E "^- " | wc -l)
    completed=$(sed -n '/## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏/,/##/p' "$ROADMAP_PATH" | grep -E "^- " | wc -l)
    
    echo "üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–¥–∞—á:"
    echo "- –í—Å–µ–≥–æ —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á: $total"
    echo "- –í—ã–ø–æ–ª–Ω–µ–Ω–æ –∑–∞–¥–∞—á: $completed"
    echo -e "\n"
}

# –û—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é
main_menu() {
    while true; do
        echo "=== ü§ñ Task Guardian - –ú–µ–Ω—é ==="
        echo "1. üìä –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å"
        echo "2. üöÄ –ü–æ–∫–∞–∑–∞—Ç—å —Ç–µ–∫—É—â–∏–µ –∑–∞–¥–∞—á–∏"
        echo "3. ‚ûï –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É"
        echo "4. ‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–¥–∞—á—É"
        echo "5. üîç –ê–Ω–∞–ª–∏–∑ –∑–∞–¥–∞—á"
        echo "6. üö™ –í—ã—Ö–æ–¥"
        echo ""
        read -p "–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ (1-6): " choice
        echo ""
        
        case $choice in
            1) show_status ;;
            2) show_tasks ;;
            3) add_task ;;
            4) complete_task ;;
            5) analyze_tasks ;;
            6) 
                echo "üëã –î–æ –≤—Å—Ç—Ä–µ—á–∏! –ü—Ä–æ–¥–æ–ª–∂–∞–π —Å–æ–∑–¥–∞–≤–∞—Ç—å —É–¥–∏–≤–∏—Ç–µ–ª—å–Ω—ã–µ –≤–µ—â–∏!"
                exit 0
                ;;
            *) echo -e "${RED}‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —á–∏—Å–ª–æ –æ—Ç 1 –¥–æ 6.${NC}\n" ;;
        esac
    done
}

# –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≥—Ä–∞–º–º—ã
clear
show_greeting
main_menu 