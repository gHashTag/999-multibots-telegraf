#!/bin/bash

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
GREEN='\033[0;32m'
RED='\033[0;31m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∞–º–±–∞—Å—Å–∞–¥–æ—Ä—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...${NC}"

# –ü—Ä–æ–≤–µ—Ä–∫–∞, –∑–∞–ø—É—â–µ–Ω –ª–∏ Docker
docker ps > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo -e "${RED}‚ùå Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø—É—Å—Ç–∏—Ç–µ Docker.${NC}"
  exit 1
fi

# –ü—Ä–æ–≤–µ—Ä–∫–∞, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
docker-compose -f docker-compose.test.yml ps | grep neuro-blogger-telegram-bot-test > /dev/null 2>&1
if [ $? -ne 0 ]; then
  echo -e "${YELLOW}‚ö†Ô∏è –¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ó–∞–ø—É—Å–∫–∞–µ–º...${NC}"
  docker-compose -f docker-compose.test.yml up -d
fi

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
echo -e "${BLUE}üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –∞–º–±–∞—Å—Å–∞–¥–æ—Ä—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π...${NC}"
docker exec neuro-blogger-telegram-bot-test npm run test:ambassador | cat

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
if [ $? -eq 0 ]; then
  echo -e "${GREEN}‚úÖ –¢–µ—Å—Ç—ã –∞–º–±–∞—Å—Å–∞–¥–æ—Ä—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω—ã!${NC}"
  exit 0
else
  echo -e "${RED}‚ùå –¢–µ—Å—Ç—ã –∞–º–±–∞—Å—Å–∞–¥–æ—Ä—Å–∫–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–∏–ª–∏—Å—å —Å –æ—à–∏–±–∫–∞–º–∏.${NC}"
  exit 1
fi 