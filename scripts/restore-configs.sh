#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
# –∏–∑ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ (—Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–æ–º–º–∏—Ç–∞ 9da4467).

SCRIPT_DIR=$(dirname "$0")
PROJECT_ROOT=$(cd "$SCRIPT_DIR/.." && pwd)
BACKUP_DIR="$PROJECT_ROOT/config_backup"

echo "üïâÔ∏è  –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏–∑ $BACKUP_DIR..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏
if [ ! -d "$BACKUP_DIR" ]; then
  echo "‚ùå –û—à–∏–±–∫–∞: –ö–∞—Ç–∞–ª–æ–≥ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏ $BACKUP_DIR –Ω–µ –Ω–∞–π–¥–µ–Ω!" >&2
  exit 1
fi

# –§–∞–π–ª—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏ –¥–ª—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è
FILES_TO_RESTORE=(
  "Dockerfile"
  "docker-compose.yml"
  "tsconfig.json"
  "package.json"
  "src/bot.ts"
  "src/config/index.ts"
)
DIRS_TO_RESTORE=(
  "nginx-config"
)

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
for file in "${FILES_TO_RESTORE[@]}"; do
  if [ -f "$BACKUP_DIR/$file" ]; then
    # –£–±–µ–¥–∏–º—Å—è, —á—Ç–æ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    DEST_DIR=$(dirname "$PROJECT_ROOT/$file")
    mkdir -p "$DEST_DIR"
    echo "    -> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ $file..."
    cp "$BACKUP_DIR/$file" "$PROJECT_ROOT/$file"
  else
    echo "‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –§–∞–π–ª $BACKUP_DIR/$file –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏." >&2
  fi
done

# –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–æ–≤
for dir in "${DIRS_TO_RESTORE[@]}"; do
  if [ -d "$BACKUP_DIR/$dir" ]; then
    echo "    -> –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–∞–ª–æ–≥–∞ $dir..."
    # –£–¥–∞–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–∞—Ç–∞–ª–æ–≥ –≤ –ø—Ä–æ–µ–∫—Ç–µ –ø–µ—Ä–µ–¥ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ–º
    rm -rf "$PROJECT_ROOT/$dir"
    cp -R "$BACKUP_DIR/$dir" "$PROJECT_ROOT/$dir"
  else
    echo "‚ö†Ô∏è –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –ö–∞—Ç–∞–ª–æ–≥ $BACKUP_DIR/$dir –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ —Ä–µ–∑–µ—Ä–≤–Ω–æ–π –∫–æ–ø–∏–∏." >&2
  fi
done

echo "‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –∏ –∫–∞—Ç–∞–ª–æ–≥–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –¥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∫–æ–º–º–∏—Ç–∞ 9da4467."

exit 0 